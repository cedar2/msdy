## 八股题（进阶、精炼）

说明：本文件补充更深层的技术问答，结合你在简历中列出的技术栈与 msdy 项目背景，答案简洁、可背诵，且尽量避免与已有 `面试准备` / `面试准备v2` 内容重复。

---

1) MySQL 中索引类型有哪些？各自适用场景？

答：B-Tree（通用单列/复合索引、范围/等值查找）、Hash（只用于内存引擎、等值查找）、Fulltext（全文检索）、Spatial（地理数据）。一般用 B-Tree，全文搜索用 Fulltext；高频等值查找可考虑覆盖索引（索引包含查询字段）以减少回表。

---

2) EXPLAIN 看到 type=ALL、possible_keys=null、rows=xxxxx，说明什么？应优先做什么？

答：type=ALL 表示全表扫描，possible_keys=null 表示没有可用索引。优先检查 WHERE 的过滤列是否有索引、是否对列使用函数或隐式转换，若需多列过滤考虑复合索引并保证索引列顺序与查询条件匹配。

---

3) MyBatis-Plus 的 LambdaQueryWrapper 有什么好处？常见误用有哪些？

答：LambdaQueryWrapper 用方法引用保证字段安全、避免写错列名，便于重构；误用包括在循环里拼接大量条件导致 SQL 复杂或动态拼接字符串而非参数化，另注意不要在 Wrapper 中传入过多子查询造成性能问题。

---

4) Redis 做缓存时的缓存穿透/击穿/雪崩分别如何防护？

答：穿透：布隆过滤器或对空结果短期缓存；击穿：互斥锁（互斥 Key）或使用永不过期并异步刷新；雪崩：加随机 TTL、分散重建时间、使用多节点冗余。

---

5) 解释乐观锁与悲观锁在库存扣减场景的实际实现代码要点。

答：乐观锁：表加 version 字段，UPDATE stock SET qty=qty-? , version=version+1 WHERE id=? AND version=?，若更新行数=0 则重试或报错。悲观锁：SELECT qty FROM stock WHERE id=? FOR UPDATE（事务内）再更新；悲观写法要注意事务时长和锁等待。

---

6) Redis 实现分布式锁常见问题及如何安全使用？

答：问题：锁过期导致持有者被误释放；单点 Redis 宕机。安全实践：使用 Redisson 或 Lua 原子脚本实现加锁/解锁、带唯一标识释放；或 RedLock 多主机算法作容错；短锁持有并加重试与幂等逻辑。

---

7) EasyExcel 写大文件时内存优化有哪些实践？

答：流式写（ExcelWriter）、按页查询 DB 并小批写入、避免把全量 List 加入内存、使用 WriteSheet 分页写出、必要时把文件写到临时文件或对象存储而非内存缓冲。

---

8) MinIO 下载流（项目里用到）如何避免 response 头编码问题的回归测试？

答：在自动化回归加一个下载用例：用 HTTP 客户端（curl 或 Java HttpClient）请求，断言 Content-Disposition 存在且 filename* 的 URL 编码与服务器预期一致；在多 User-Agent 下验证中文名解析。

---

9) p6spy 的作用是什么？在定位慢 SQL 时怎么配合使用？

答：p6spy 可拦截并打印最终执行的 SQL（含参数），便于在应用层看到拼接后语句。配合 AOP 慢方法日志使用：定位慢方法 -> 在测试环境用 p6spy 捕获实际 SQL -> 用 EXPLAIN 分析并定位瓶颈。

---

10) 如何设计接口的幂等性（短答要点）？

答：接收端生成或要求传入幂等 key（idempotency-key），入库前写入幂等表（状态 machine），业务执行前检查，执行结束写状态及结果；幂等表保证并发只执行一次，接口返回缓存结果。

---

11) JVM 的常见 GC 调优思路（最小化回答）？

答：先收集 GC 日志与堆快照，判断是 Young GC 频繁还是 Full GC；增大堆或调节 Young/Old 比例，选合适 GC（G1 默认适合大堆），若停顿敏感考虑 ZGC/Shenandoah；优化对象分配/短命对象，减少频繁分配。

---

12) N+1 问题在 MyBatis/MyBatis-Plus 中如何识别与解决？

答：识别：日志显示大量重复的单行 select。解决：使用 join+一次性查询（或 IN 查询）把关联数据批量拉取；或用二级缓存/预热；如果是分页结果需先获取主键列表再批量查详情。

---

13) 设计库存服务时，为什么会考虑 CQRS 或事件溯源？简短说明适用场景。

答：CQRS 把读写分离，读侧可为高并发优化，写侧负责一致性；事件溯源记录状态变化方便补偿与审计。适合业务复杂、需审计或补偿操作多的场景，但实现复杂、调试成本高，先用事务+消息队列再演进。

---

14) Spring `@Transactional` 的常见误区有哪些？

答：1) 在同类内部方法调用导致事务不生效（需代理外部调用或使用 AspectJ）；2) 在 Controller 层使用长事务导致锁表；3) 忽略异常类型（默认只回滚 RuntimeException），需显式设置 rollbackFor。

---

15) 如何用 SQL/架构避免分页查询导致性能问题？

答：避免 OFFSET 大页深度查询，改用基于索引的 keyset pagination（WHERE id>lastId LIMIT n）或预聚合/物化视图；对历史/冷数据做归档分区表。

---

16) 常见的 API 安全与鉴权要点（简短）？

答：使用 TLS、身份认证（JWT/OAuth2）、接口限流、权限校验（基于角色/资源）、输入校验+参数化查询防注入、敏感数据脱敏与最小权限原则。

---

17) 在 CI 中如何快速发现 SQL 映射错误或编译问题？

答：CI 增加构建阶段运行单元/集成测试（带内存 DB 或 Testcontainers），并且在构建时开启 MyBatis mapper 校验插件或自定义脚本扫描 mapper XML 与实体字段对齐，自动失败并通知。

---

18) 拉取依赖或升级框架时如何评估风险？

答：先在隔离的分支做升级，运行全量测试（单元+集成+端到端）、流量旁路或小流量灰度，检查性能/GC/安全扫描结果，回滚计划与 DB 迁移脚本要提前准备。

---

19) 日常排查线上慢调用的快速步骤（3 步骤）？

答：1) 用 APM/日志定位慢接口（时间/频率）；2) 回放或在预生产用相同参数重现并抓 SQL；3) EXPLAIN + 索引/SQL 重写 + 缓存或异步化验证。

---

20) 面试官通常喜欢“你会怎么学习/填补知识空白”的简短回答？

答：快速阅读官方文档与源代码示例，实践小 demo 验证假设，结合社区/博客与同行讨论，最后把结论写成 PR 或文档分享团队，形成闭环。

---

文件已写入 `八股题.md`。如果你希望我把这些题再压缩为“面试速查卡”（6–8 条），或把某几题扩展为示例代码片段，我可以继续为你生成。 

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.system.mapper.SysNoticeMapper">

    <resultMap type="com.platform.system.domain.SysNotice" id="SysNoticeResult">
        <result property="clientId" column="client_id"/>
        <result property="noticeSid" column="notice_sid"/>
        <result property="noticeCode" column="notice_code"/>
        <result property="noticeTitle" column="notice_title"/>
        <result property="noticeType" column="notice_type"/>
        <result property="noticeContent" column="notice_content"/>
        <result property="dateStart" column="date_start"/>
        <result property="dateEnd" column="date_end"/>
        <result property="serialNum" column="serial_num"/>
        <result property="rangeType" column="range_type"/>
        <result property="remark" column="remark"/>
        <result property="status" column="status"/>
        <result property="handleStatus" column="handle_status"/>
        <result property="creatorAccount" column="creator_account"/>
        <result property="createDate" column="create_date"/>
        <result property="updaterAccount" column="updater_account"/>
        <result property="updateDate" column="update_date"/>
        <result property="confirmerAccount" column="confirmer_account"/>
        <result property="confirmDate" column="confirm_date"/>
        <result property="dataSourceSys" column="data_source_sys"/>
        <result property="creatorAccountName" column="creator_account_name"/>
        <result property="confirmerAccountName" column="confirmer_account_name"/>
        <result property="updaterAccountName" column="updater_account_name"/>
    </resultMap>

    <sql id="selectNoticeVo">
        select notice_id,
               notice_title,
               notice_type,
               cast(notice_content as char) as notice_content,
               status,
               create_by,
               create_time,
               update_by,
               update_time,
               remark
        from sys_notice
    </sql>

    <select id="selectNoticeById" parameterType="Long" resultMap="SysNoticeResult">
        <include refid="selectNoticeVo"/>
        where notice_id = #{noticeId}
    </select>

    <select id="selectNoticeList" parameterType="com.platform.system.domain.SysNotice" resultMap="SysNoticeResult">
        <include refid="selectNoticeVo"/>
        <where>
            <if test="noticeTitle != null and noticeTitle != ''">
                AND notice_title like concat('%', #{noticeTitle}, '%')
            </if>
            <if test="noticeType != null and noticeType != ''">
                AND notice_type = #{noticeType}
            </if>
            <if test="createBy != null and createBy != ''">
                AND create_by like concat('%', #{createBy}, '%')
            </if>
        </where>
    </select>

    <insert id="insertNotice" parameterType="com.platform.system.domain.SysNotice">
        insert into sys_notice (
        <if test="noticeTitle != null and noticeTitle != '' ">notice_title,</if>
        <if test="noticeType != null and noticeType != '' ">notice_type,</if>
        <if test="noticeContent != null and noticeContent != '' ">notice_content,</if>
        <if test="status != null and status != '' ">status,</if>
        <if test="remark != null and remark != ''">remark,</if>
        <if test="createBy != null and createBy != ''">create_by,</if>
        create_time
        )values(
        <if test="noticeTitle != null and noticeTitle != ''">#{noticeTitle},</if>
        <if test="noticeType != null and noticeType != ''">#{noticeType},</if>
        <if test="noticeContent != null and noticeContent != ''">#{noticeContent},</if>
        <if test="status != null and status != ''">#{status},</if>
        <if test="remark != null and remark != ''">#{remark},</if>
        <if test="createBy != null and createBy != ''">#{createBy},</if>
        sysdate()
        )
    </insert>

    <update id="updateNotice" parameterType="com.platform.system.domain.SysNotice">
        update sys_notice
        <set>
            <if test="noticeTitle != null and noticeTitle != ''">notice_title = #{noticeTitle},</if>
            <if test="noticeType != null and noticeType != ''">notice_type = #{noticeType},</if>
            <if test="noticeContent != null">notice_content = #{noticeContent},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
            update_time = sysdate()
        </set>
        where notice_id = #{noticeId}
    </update>

    <delete id="deleteNoticeById" parameterType="Long">
        delete
        from sys_notice
        where notice_id = #{noticeId}
    </delete>

    <delete id="deleteNoticeByIds" parameterType="Long">
        delete from sys_notice where notice_id in
        <foreach item="noticeId" collection="array" open="(" separator="," close=")">
            #{noticeId}
        </foreach>
    </delete>


    <sql id="selectSysNoticeVo">
        select
            t.client_id,
            t.notice_sid,
            t.notice_code,
            t.notice_title,
            t.notice_type,
            t.notice_content,
            t.date_start,
            t.date_end,
            t.serial_num,
            t.range_type,
            t.remark,
            t.status,
            t.handle_status,
            t.creator_account,
            t.create_date,
            t.updater_account,
            t.update_date,
            t.confirmer_account,
            t.confirm_date,
            t.data_source_sys,
            t1.nick_name as creator_account_name,
            t2.nick_name as confirmer_account_name,
            t3.nick_name as updater_account_name
        from s_sys_notice t
                 LEFT JOIN sys_user t1 ON t1.user_name = t.creator_account
                 LEFT JOIN sys_user t2 ON t2.user_name = t.confirmer_account
                 LEFT JOIN sys_user t3 ON t3.user_name = t.updater_account
    </sql>

    <select id="selectSysNoticeById" parameterType="Long" resultMap="SysNoticeResult">
        <include refid="selectSysNoticeVo"/>
        where t.notice_sid = #{noticeSid}
    </select>


    <select id="selectSysNoticeList" parameterType="com.platform.system.domain.SysNotice"
            resultMap="SysNoticeResult">
        <include refid="selectSysNoticeVo"/>
        <where>
            <if test="clientId != null  and clientId != ''">
                and t.client_id = #{clientId}
            </if>
            <if test="noticeCode != null ">
                and t.notice_code like concat('%',#{noticeCode}, '%')
            </if>
            <if test="noticeTitle != null  and noticeTitle != ''">
                and (<foreach collection="noticeTitle.split(';')" item="item" separator="or">t.notice_title like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="noticeType != null  and noticeType != ''">
                and t.notice_type = #{noticeType}
            </if>
            <if test="noticeTypeList != null and noticeTypeList.length >0 ">
                and t.notice_type in
                (<foreach collection="noticeTypeList" item="item" separator=",">#{item}</foreach>)
            </if>
            <if test="noticeContent != null  and noticeContent != ''">
                and (<foreach collection="noticeContent.split(';')" item="item" separator="or">t.notice_content like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="serialNum != null ">
                and t.serial_num =#{serialNum}
            </if>
            <if test="rangeType != null  and rangeType != ''">
                and t.range_type = #{rangeType}
            </if>
            <if test="status != null  and status != ''">
                and t.status= #{status}
            </if>
            <if test="handleStatus != null  and handleStatus != ''">
                and t.handle_status = #{handleStatus}
            </if>
            <if test="handleStatusList != null and handleStatusList.length >0 ">
                and t.handle_status in
                (<foreach collection="handleStatusList" item="item" separator=",">#{item}</foreach>)
            </if>
            <if test="creatorAccount != null  and creatorAccount != ''">
                and (<foreach collection="creatorAccount.split(';')" item="item" separator="or">t1.nick_name like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="today != null ">
                and t.date_start &lt;= #{today} and t.date_end &gt;= #{today}
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="updaterAccount != null  and updaterAccount != ''">
                and (<foreach collection="updaterAccount.split(';')" item="item" separator="or">t.updater_account like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="updateDate != null ">
                and t.update_date = #{updateDate}
            </if>
            <if test="confirmerAccount != null  and confirmerAccount != ''">
                and (<foreach collection="confirmerAccount.split(';')" item="item" separator="or">t.confirmer_account
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="confirmDate != null ">
                and t.confirm_date = #{confirmDate}
            </if>
            <if test="dataSourceSys != null  and dataSourceSys != ''">
                and (<foreach collection="dataSourceSys.split(';')" item="item" separator="or">t.data_source_sys like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
        order by t.notice_code desc, t.confirm_date desc
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_sys_notice
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            notice_sid,
            notice_code,
            notice_title,
            notice_type,
            notice_content,
            date_start,
            date_end,
            serial_num,
            range_type,
            remark,
            status,
            handle_status,
            creator_account,
            create_date,
            updater_account,
            update_date,
            confirmer_account,
            confirm_date,
            data_source_sys,
        </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                #{item.clientId},
                #{item.noticeSid},
                #{item.noticeCode},
                #{item.noticeTitle},
                #{item.noticeType},
                #{item.noticeContent},
                #{item.dateStart},
                #{item.dateEnd},
                #{item.serialNum},
                #{item.rangeType},
                #{item.remark},
                #{item.status},
                #{item.handleStatus},
                #{item.creatorAccount},
                #{item.createDate},
                #{item.updaterAccount},
                #{item.updateDate},
                #{item.confirmerAccount},
                #{item.confirmDate},
                #{item.dataSourceSys},
            </trim>
        </foreach>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_sys_notice
        <trim prefix="SET" suffixOverrides=",">
            notice_code = #{noticeCode},
            notice_title = #{noticeTitle},
            notice_type = #{noticeType},
            notice_content = #{noticeContent},
            date_start = #{dateStart},
            date_end = #{dateEnd},
            serial_num = #{serialNum},
            range_type = #{rangeType},
            remark = #{remark},
            status = #{status},
            handle_status = #{handleStatus},
            updater_account = #{updaterAccount},
            update_date = #{updateDate},
            confirmer_account = #{confirmerAccount},
            confirm_date = #{confirmDate},
            data_source_sys = #{dataSourceSys},
        </trim>
        where notice_sid = #{noticeSid}
    </update>

    <!--更新多个-->
    <update id="updatesAllById">
        <foreach collection="list" item="o" separator=";">
            update s_sys_notice
            <trim prefix="SET" suffixOverrides=",">
                notice_code = #{noticeCode},
                notice_title = #{noticeTitle},
                notice_type = #{noticeType},
                notice_content = #{noticeContent},
                date_start = #{dateStart},
                date_end = #{dateEnd},
                serial_num = #{serialNum},
                range_type = #{rangeType},
                remark = #{remark},
                status = #{status},
                handle_status = #{handleStatus},
                updater_account = #{updaterAccount},
                update_date = #{updateDate},
                confirmer_account = #{confirmerAccount},
                confirm_date = #{confirmDate},
                data_source_sys = #{dataSourceSys},
            </trim>
            where notice_sid = #{noticeSid}
        </foreach>
    </update>

</mapper>

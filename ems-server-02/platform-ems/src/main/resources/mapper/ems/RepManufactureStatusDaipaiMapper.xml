<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.RepManufactureStatusDaipaiMapper">

    <resultMap type="com.platform.ems.domain.RepManufactureStatusDaipai" id="RepManufactureStatusDaipaiResult">
        <result property="clientId" column="client_id"/>
        <result property="dataRecordSid" column="data_record_sid"/>
        <result property="salesOrderSid" column="sales_order_sid"/>
        <result property="salesOrderCode" column="sales_order_code"/>
        <result property="companyCode" column="company_code"/>
        <result property="companyName" column="company_name"/>
        <result property="productSeasonCode" column="product_season_code"/>
        <result property="customerSid" column="customer_sid"/>
        <result property="customerCode" column="customer_code"/>
        <result property="customerShortName" column="customer_short_name"/>
        <result property="salesOrderItemSid" column="sales_order_item_sid"/>
        <result property="materialSid" column="material_sid"/>
        <result property="materialCode" column="material_code"/>
        <result property="sku1Sid" column="sku1_sid"/>
        <result property="sku1Code" column="sku1_code"/>
        <result property="sku2Sid" column="sku2_sid"/>
        <result property="sku2Code" column="sku2_code"/>
        <result property="contractDate" column="contract_date"/>
        <result property="quantityDingd" column="quantity_dingd"/>
        <result property="quantityYipc" column="quantity_yipc"/>
        <result property="quantityDaipc" column="quantity_daipc"/>
        <result property="createDate" column="create_date"/>
    </resultMap>

    <sql id="selectRepManufactureStatusDaipaiVo">
        select t.client_id,
               t.data_record_sid,
               t.sales_order_sid,
               t.sales_order_code,
            .company_code,
            t.company_name,
            t.product_season_code,
            t.customer_sid,
            t.customer_code,
            t.customer_short_name,
            t.sales_order_item_sid,
            t.material_sid,
            t.material_code,
            t.sku1_sid,
            t.sku1_code,
            t.sku2_sid,
            t.sku2_code,
            t.contract_date,
            t.quantity_dingd,
            t.quantity_yipc,
            t.quantity_daipc,
            t.create_date
        from s_rep_manufacture_status_daipai t
    </sql>

    <select id="selectRepManufactureStatusDaipaiById" parameterType="Long" resultMap="RepManufactureStatusDaipaiResult">
        <include refid="selectRepManufactureStatusDaipaiVo"/>
        where t.data_record_sid = #{dataRecordSid}
    </select>

    <select id="getRepManufactureStatusDaipaiList" parameterType="com.platform.ems.domain.RepManufactureStatusDaipai"
            resultType="com.platform.ems.domain.RepManufactureStatusDaipai">
        select
        t.sales_order_item_sid,
        t.sales_order_sid,
        t.material_sid,
        t.sku1_sid,
        t.sku2_sid,
        t.quantity as quantity_dingd,
        t.contract_date,
        t2.sales_order_code,
        t2.customer_sid,
        t4.quantity as quantity_yipc,
        t5.company_code,
        ifnull(t5.short_name,t5.company_name) as company_name,
        t6.customer_code,
        t6.short_name as customer_short_name,
        t7.product_season_code,
        t8.material_code,
        t8.material_name,
        t9.sku_code as sku1_code,
        t10.sku_code as sku2_code,
        (if(t.quantity > t4.quantity,t.quantity-t4.quantity,0)) as quantity_daipc
        from s_sal_sales_order_item t
        left join s_sal_sales_order t2 on t.sales_order_sid = t2.sales_order_sid
        left join s_man_manufacture_order_product t4 on t.sales_order_item_sid = t4.sales_order_item_sid
        left join s_bas_company t5 on t2.company_sid = t5.company_sid
        left join s_bas_customer t6 on t2.customer_sid = t6.customer_sid
        left join s_bas_product_season t7 on t2.product_season_sid = t7.product_season_sid
        left join s_bas_material t8 on t.material_sid = t8.material_sid
        left join s_bas_sku t9 on t.sku1_sid = t9.sku_sid
        left join s_bas_sku t10 on t.sku2_sid = t10.sku_sid
        <where>
            <if test="clientId != null and clientId != ''">
                and t.client_id = #{clientId}
            </if>
            <if test="handleStatus != null and handleStatus != ''">
                and t2.handle_status = #{handleStatus}
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
    </select>

    <select id="selectRepManufactureStatusDaipaiList" parameterType="com.platform.ems.domain.RepManufactureStatusDaipai"
            resultMap="RepManufactureStatusDaipaiResult">
        <include refid="selectRepManufactureStatusDaipaiVo"/>
        <where>
            <if test="clientId != null  and clientId != ''">
                and (<foreach collection="clientId.split(';')" item="item" separator="or">t.client_id =
                #{item}</foreach>)
            </if>
            <if test="salesOrderSid != null ">
                and t.sales_order_sid =#{salesOrderSid}
            </if>
            <if test="salesOrderCode != null ">
                and t.sales_order_code =#{salesOrderCode}
            </if>
            <if test="companyCode != null  and companyCode != ''">
                and (<foreach collection="companyCode.split(';')" item="item" separator="or">t.company_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="companyName != null  and companyName != ''">and
                t.company_name like concat('%', #{companyName}, '%')
            </if>
            <if test="productSeasonCode != null  and productSeasonCode != ''">
                and (<foreach collection="productSeasonCode.split(';')" item="item" separator="or">t.product_season_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="customerSid != null ">
                and t.customer_sid =#{customerSid}
            </if>
            <if test="customerCode != null  and customerCode != ''">
                and (<foreach collection="customerCode.split(';')" item="item" separator="or">t.customer_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="customerShortName != null  and customerShortName != ''">and
                t.customer_short_name like concat('%', #{customerShortName}, '%')
            </if>
            <if test="salesOrderItemSid != null ">
                and t.sales_order_item_sid =#{salesOrderItemSid}
            </if>
            <if test="materialSid != null ">
                and t.material_sid =#{materialSid}
            </if>
            <if test="materialCode != null  and materialCode != ''">
                and (<foreach collection="materialCode.split(';')" item="item" separator="or">t.material_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="sku1Sid != null ">
                and t.sku1_sid =#{sku1Sid}
            </if>
            <if test="sku1Code != null  and sku1Code != ''">
                and (<foreach collection="sku1Code.split(';')" item="item" separator="or">t.sku1_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="sku2Sid != null ">
                and t.sku2_sid =#{sku2Sid}
            </if>
            <if test="sku2Code != null  and sku2Code != ''">
                and (<foreach collection="sku2Code.split(';')" item="item" separator="or">t.sku2_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="contractDate != null ">
                and t.contract_date = #{contractDate}
            </if>
            <if test="quantityDingd != null ">
                and t.quantity_dingd = #{quantityDingd}
            </if>
            <if test="quantityYipc != null ">
                and t.quantity_yipc = #{quantityYipc}
            </if>
            <if test="quantityDaipc != null ">
                and t.quantity_daipc = #{quantityDaipc}
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_rep_manufacture_status_daipai
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            data_record_sid,
            sales_order_sid,
            sales_order_code,
            company_code,
            company_name,
            product_season_code,
            customer_sid,
            customer_code,
            customer_short_name,
            sales_order_item_sid,
            material_sid,
            material_code,
            sku1_sid,
            sku1_code,
            sku2_sid,
            sku2_code,
            contract_date,
            quantity_dingd,
            quantity_yipc,
            quantity_daipc,
            create_date,
        </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                #{item.clientId},
                #{item.dataRecordSid},
                #{item.salesOrderSid},
                #{item.salesOrderCode},
                #{item.companyCode},
                #{item.companyName},
                #{item.productSeasonCode},
                #{item.customerSid},
                #{item.customerCode},
                #{item.customerShortName},
                #{item.salesOrderItemSid},
                #{item.materialSid},
                #{item.materialCode},
                #{item.sku1Sid},
                #{item.sku1Code},
                #{item.sku2Sid},
                #{item.sku2Code},
                #{item.contractDate},
                #{item.quantityDingd},
                #{item.quantityYipc},
                #{item.quantityDaipc},
                #{item.createDate},
            </trim>
        </foreach>
    </insert>

</mapper>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.RepManufactureStatusZaichaMapper">

    <resultMap type="com.platform.ems.domain.RepManufactureStatusZaicha" id="RepManufactureStatusZaichaResult">
        <result property="clientId" column="client_id"/>
        <result property="dataRecordSid" column="data_record_sid"/>
        <result property="manufactureOrderSid" column="manufacture_order_sid"/>
        <result property="manufactureOrderCode" column="manufacture_order_code"/>
        <result property="plantSid" column="plant_sid"/>
        <result property="plantCode" column="plant_code"/>
        <result property="plantShortName" column="plant_short_name"/>
        <result property="moBusinessType" column="mo_business_type"/>
        <result property="manufactureOrderProductSid" column="manufacture_order_product_sid"/>
        <result property="materialSid" column="material_sid"/>
        <result property="materialCode" column="material_code"/>
        <result property="sku1Sid" column="sku1_sid"/>
        <result property="sku1Code" column="sku1_code"/>
        <result property="sku2Sid" column="sku2_sid"/>
        <result property="sku2Code" column="sku2_code"/>
        <result property="planEndDateMo" column="plan_end_date_mo"/>
        <result property="planEndDateProduct" column="plan_end_date_product"/>
        <result property="quantityJih" column="quantity_jih"/>
        <result property="quantityYiwc" column="quantity_yiwc"/>
        <result property="quantityWeiwc" column="quantity_weiwc"/>
        <result property="customerSid" column="customer_sid"/>
        <result property="customerCode" column="customer_code"/>
        <result property="customerShortName" column="customer_short_name"/>
        <result property="productSeasonCode" column="product_season_code"/>
        <result property="salesOrderSid" column="sales_order_sid"/>
        <result property="salesOrderCode" column="sales_order_code"/>
        <result property="salesOrderItemSid" column="sales_order_item_sid"/>
        <result property="createDate" column="create_date"/>
    </resultMap>

    <sql id="selectRepManufactureStatusZaichaVo">
        select t.client_id,
            .data_record_sid,
            t.manufacture_order_sid,
            t.manufacture_order_code,
            t.plant_sid,
            t.plant_code,
            t.plant_short_name,
            t.mo_business_type,
            t.manufacture_order_product_sid,
            t.material_sid,
            t.material_code,
            t.sku1_sid,
            t.sku1_code,
            t.sku2_sid,
            t.sku2_code,
            t.plan_end_date_mo,
            t.plan_end_date_product,
            t.quantity_jih,
            t.quantity_yiwc,
            t.quantity_weiwc,
            t.customer_sid,
            t.customer_code,
            t.customer_short_name,
            t.product_season_code,
            t.sales_order_sid,
            t.sales_order_code,
            t.sales_order_item_sid,
            t.create_date
        from s_rep_manufacture_status_zaicha t
    </sql>

    <select id="selectRepManufactureStatusZaichaById" parameterType="Long" resultMap="RepManufactureStatusZaichaResult">
        <include refid="selectRepManufactureStatusZaichaVo"/>
        where t.data_record_sid = #{dataRecordSid}
    </select>

    <select id="getRepManufactureStatusZaichaList" parameterType="com.platform.ems.domain.RepManufactureStatusZaicha"
            resultType="com.platform.ems.domain.RepManufactureStatusZaicha">
        select
        t.manufacture_order_product_sid,
        t.manufacture_order_sid,
        t.material_sid,
        t.sku1_sid,
        t.sku2_sid,
        t.quantity,
        t.plan_end_date as plan_end_date_product,
        t2.manufacture_order_code,
        t2.plant_sid,
        t2.business_type as mo_business_type,
        t2.quantity as quantity_jih,
        t2.in_store_quantity as quantity_yiwc,
        t2.plan_end_date as plan_end_date_mo,
        t3.sales_order_item_sid,
        t3.sales_order_sid,
        t3.quantity as quantity_dingd,
        t3.contract_date,
        t4.sales_order_code,
        t4.customer_sid,
        t5.company_code,
        ifnull(t5.short_name,t5.company_name) as company_name,
        t6.customer_code,
        t6.short_name as customer_short_name,
        t7.plant_code,
        t7.plant_name,
        t7.short_name as plant_short_name,
        t8.product_season_code,
        t9.material_code,
        t9.material_name,
        t10.sku_code as sku1_code,
        t11.sku_code as sku2_code,
        (t.quantity - t12.quantity) as quantity_weiwc
        from s_man_manufacture_order_product t
        left join s_man_manufacture_order t2 on t.manufacture_order_sid = t2.manufacture_order_sid
        left join s_sal_sales_order_item t3 on t.sales_order_item_sid = t3.sales_order_item_sid
        left join s_sal_sales_order t4 on t3.sales_order_sid = t4.sales_order_sid
        left join s_bas_company t5 on t2.company_sid = t5.company_sid
        left join s_bas_customer t6 on t4.customer_sid = t6.customer_sid
        left join s_bas_plant t7 on t2.plant_sid = t7.plant_sid
        left join s_bas_product_season t8 on t4.product_season_sid = t8.product_season_sid
        left join s_bas_material t9 on t.material_sid = t9.material_sid
        left join s_bas_sku t10 on t.sku1_sid = t10.sku_sid
        left join s_bas_sku t11 on t.sku2_sid = t11.sku_sid
        left join s_inv_inventory_document_item t12 on t.manufacture_order_product_sid = t12.refer_document_item_sid
        <where>
            <if test="clientId != null and clientId != ''">
                and t.client_id = #{clientId}
            </if>
            <if test="handleStatus != null and handleStatus != ''">
                and t2.handle_status = #{handleStatus}
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
    </select>

    <select id="selectRepManufactureStatusZaichaList" parameterType="com.platform.ems.domain.RepManufactureStatusZaicha"
            resultMap="RepManufactureStatusZaichaResult">
        <include refid="selectRepManufactureStatusZaichaVo"/>
        <where>
            <if test="clientId != null  and clientId != ''">
                and (<foreach collection="clientId.split(';')" item="item" separator="or">t.client_id =
                #{item}</foreach>)
            </if>
            <if test="manufactureOrderSid != null ">
                and t.manufacture_order_sid =#{manufactureOrderSid}
            </if>
            <if test="manufactureOrderCode != null ">
                and t.manufacture_order_code =#{manufactureOrderCode}
            </if>
            <if test="plantSid != null ">
                and t.plant_sid =#{plantSid}
            </if>
            <if test="plantCode != null  and plantCode != ''">
                and (<foreach collection="plantCode.split(';')" item="item" separator="or">t.plant_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="plantShortName != null  and plantShortName != ''">and
                t.plant_short_name like concat('%', #{plantShortName}, '%')
            </if>
            <if test="moBusinessType != null  and moBusinessType != ''">
                and (<foreach collection="moBusinessType.split(';')" item="item" separator="or">t.mo_business_type
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="manufactureOrderProductSid != null ">
                and t.manufacture_order_product_sid =#{manufactureOrderProductSid}
            </if>
            <if test="materialSid != null ">
                and t.material_sid =#{materialSid}
            </if>
            <if test="materialCode != null  and materialCode != ''">
                and (<foreach collection="materialCode.split(';')" item="item" separator="or">t.material_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="sku1Sid != null ">
                and t.sku1_sid =#{sku1Sid}
            </if>
            <if test="sku1Code != null  and sku1Code != ''">
                and (<foreach collection="sku1Code.split(';')" item="item" separator="or">t.sku1_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="sku2Sid != null ">
                and t.sku2_sid =#{sku2Sid}
            </if>
            <if test="sku2Code != null  and sku2Code != ''">
                and (<foreach collection="sku2Code.split(';')" item="item" separator="or">t.sku2_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="planEndDateMo != null ">
                and t.plan_end_date_mo = #{planEndDateMo}
            </if>
            <if test="planEndDateProduct != null ">
                and t.plan_end_date_product = #{planEndDateProduct}
            </if>
            <if test="quantityJih != null ">
                and t.quantity_jih = #{quantityJih}
            </if>
            <if test="quantityYiwc != null ">
                and t.quantity_yiwc = #{quantityYiwc}
            </if>
            <if test="quantityWeiwc != null ">
                and t.quantity_weiwc = #{quantityWeiwc}
            </if>
            <if test="customerSid != null ">
                and t.customer_sid =#{customerSid}
            </if>
            <if test="customerCode != null  and customerCode != ''">
                and (<foreach collection="customerCode.split(';')" item="item" separator="or">t.customer_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="customerShortName != null  and customerShortName != ''">and
                t.customer_short_name like concat('%', #{customerShortName}, '%')
            </if>
            <if test="productSeasonCode != null  and productSeasonCode != ''">
                and (<foreach collection="productSeasonCode.split(';')" item="item" separator="or">t.product_season_code
                like concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="salesOrderSid != null ">
                and t.sales_order_sid =#{salesOrderSid}
            </if>
            <if test="salesOrderCode != null ">
                and t.sales_order_code =#{salesOrderCode}
            </if>
            <if test="salesOrderItemSid != null ">
                and t.sales_order_item_sid =#{salesOrderItemSid}
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_rep_manufacture_status_zaicha
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            data_record_sid,
            manufacture_order_sid,
            manufacture_order_code,
            plant_sid,
            plant_code,
            plant_short_name,
            mo_business_type,
            manufacture_order_product_sid,
            material_sid,
            material_code,
            sku1_sid,
            sku1_code,
            sku2_sid,
            sku2_code,
            plan_end_date_mo,
            plan_end_date_product,
            quantity_jih,
            quantity_yiwc,
            quantity_weiwc,
            customer_sid,
            customer_code,
            customer_short_name,
            product_season_code,
            sales_order_sid,
            sales_order_code,
            sales_order_item_sid,
            create_date,
        </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                #{item.clientId},
                #{item.dataRecordSid},
                #{item.manufactureOrderSid},
                #{item.manufactureOrderCode},
                #{item.plantSid},
                #{item.plantCode},
                #{item.plantShortName},
                #{item.moBusinessType},
                #{item.manufactureOrderProductSid},
                #{item.materialSid},
                #{item.materialCode},
                #{item.sku1Sid},
                #{item.sku1Code},
                #{item.sku2Sid},
                #{item.sku2Code},
                #{item.planEndDateMo},
                #{item.planEndDateProduct},
                #{item.quantityJih},
                #{item.quantityYiwc},
                #{item.quantityWeiwc},
                #{item.customerSid},
                #{item.customerCode},
                #{item.customerShortName},
                #{item.productSeasonCode},
                #{item.salesOrderSid},
                #{item.salesOrderCode},
                #{item.salesOrderItemSid},
                #{item.createDate},
            </trim>
        </foreach>
    </insert>

</mapper>

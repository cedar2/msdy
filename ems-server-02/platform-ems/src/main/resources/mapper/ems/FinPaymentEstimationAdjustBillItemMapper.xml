<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.FinPaymentEstimationAdjustBillItemMapper">

    <resultMap type="com.platform.ems.domain.FinPaymentEstimationAdjustBillItem"
               id="FinPaymentEstimationAdjustBillItemResult">
        <result property="clientId" column="client_id"/>
        <result property="paymentEstimationAdjustBillItemSid" column="payment_estimation_adjust_bill_item_sid"/>
        <result property="paymentEstimationAdjustBillSid" column="payment_estimation_adjust_bill_sid"/>
        <result property="materialSid" column="material_sid"/>
        <result property="sku1Sid" column="sku1_sid"/>
        <result property="sku2Sid" column="sku2_sid"/>
        <result property="barcodeSid" column="barcode_sid"/>
        <result property="materialName" column="material_name"/>
        <result property="specification" column="specification"/>
        <result property="quantityNew" column="quantity_new"/>
        <result property="priceNew" column="price_new"/>
        <result property="priceTaxNew" column="price_tax_new"/>
        <result property="quantityOld" column="quantity_old"/>
        <result property="priceOld" column="price_old"/>
        <result property="priceTaxOld" column="price_tax_old"/>
        <result property="itemNum" column="item_num"/>
        <result property="accountDocumentSid" column="account_document_sid"/>
        <result property="accountDocumentCode" column="account_document_code"/>
        <result property="bookType" column="book_type"/>
        <result property="bookSourceCategory" column="book_source_category"/>
        <result property="accountItemSid" column="account_item_sid"/>
        <result property="accountItemCode" column="account_item_code"/>
        <result property="remark" column="remark"/>
        <result property="creatorAccount" column="creator_account"/>
        <result property="createDate" column="create_date"/>
        <result property="updaterAccount" column="updater_account"/>
        <result property="updateDate" column="update_date"/>
        <result property="dataSourceSys" column="data_source_sys"/>
        <result property="creatorAccountName" column="creator_account_name"/>
        <result property="updaterAccountName" column="updater_account_name"/>
        <result property="materialCode" column="material_code"/>
        <result property="sku1Name" column="sku1_name"/>
        <result property="sku1Code" column="sku1_code"/>
        <result property="sku2Code" column="sku2_code"/>
        <result property="sku2Name" column="sku2_name"/>
        <result property="bookPaymentEstimationCode" column="book_payment_estimation_code"/>
        <result property="bookTypeName" column="book_type_name"/>
        <result property="bookSourceCategoryName" column="book_source_category_name"/>
        <result property="quantity" column="quantity"/>
        <result property="quantityLeft" column="quantity_left"/>
        <result property="currencyAmountTax" column="currency_amount_tax"/>
        <result property="currencyAmountTaxYhx" column="currency_amount_tax_yhx"/>
        <result property="currencyAmountTaxHxz" column="currency_amount_tax_hxz"/>
        <result property="taxRate" column="tax_rate"/>
        <result property="unitPriceName" column="unit_price_name"/>
        <result property="deliveryNoteCode" column="delivery_note_code"/>
        <result property="purchaseOrderCode" column="purchase_order_code"/>
        <result property="purchaseContractCode" column="purchase_contract_code"/>
        <result property="accountsMethodGroupName" column="accounts_method_group_name"/>
    </resultMap>

    <sql id="selectFinPaymentEstimationAdjustBillItemVo">
        select t.client_id,
               t.payment_estimation_adjust_bill_item_sid,
               t.payment_estimation_adjust_bill_sid,
               t.material_sid,
               t.sku1_sid,
               t.sku2_sid,
               t.barcode_sid,
               t.material_name,
               t.specification,
               t.quantity_new,
               t.price_new,
               t.price_tax_new,
               t.quantity_old,
               t.price_old,
               t.price_tax_old,
               t.item_num,
               t.account_document_sid,
               t.account_document_code,
               t.account_document_code as book_payment_estimation_code,
               t.book_type,
               t.book_source_category,
               t.account_item_sid,
               t.account_item_code,
               t.remark,
               t.creator_account,
               t.create_date,
               t.updater_account,
               t.update_date,
               t.data_source_sys,
               t2.nick_name AS creator_account_name,
               t3.nick_name AS updater_account_name,
               t4.material_code,
               t5.sku_name AS sku1_name,
               t5.sku_code AS sku1_code,
               t6.sku_name AS sku2_name,
               t6.sku_code AS sku2_code,
               t7.book_payment_estimation_code,
               t8.quantity,
               t8.price_tax,
               (t8.quantity - t8.quantity_yhx - t8.quantity_hxz) AS quantity_left,
               t8.currency_amount_tax,
               t8.currency_amount_tax_yhx,
               t8.currency_amount_tax_hxz,
               t8.tax_rate,
               t9.name AS book_type_name,
               t10.name AS book_source_category_name,
               t11.name AS unit_price_name,
               t12.purchase_order_code,
               t13.purchase_contract_code,
               t14.delivery_note_code,
               t15.name AS accounts_method_group_name
        from s_fin_payment_estimation_adjust_bill_item t
         left join sys_user t2 on t.creator_account = t2.user_name
         left join sys_user t3 on t.updater_account = t3.user_name
         left join s_bas_material t4 on t.material_sid = t4.material_sid
         left join s_bas_sku t5 on t.sku1_sid = t5.sku_sid
         left join s_bas_sku t6 on t.sku2_sid = t6.sku_sid
         left join s_fin_book_payment_estimation t7 on t.account_document_sid = t7.book_payment_estimation_sid
         left join s_fin_book_payment_estimation_item t8 on t.account_item_sid = t8.book_payment_estimation_item_sid
         left join s_con_book_type t9 ON t.book_type = t9.code
         left join s_con_book_source_category t10 ON t.book_source_category = t10.code
         LEFT JOIN s_con_measure_unit t11 ON t8.unit_price = t11.code
         LEFT JOIN s_pur_purchase_order t12 ON t8.purchase_order_sid = t12.purchase_order_sid
         LEFT JOIN s_pur_purchase_contract t13 ON t8.purchase_contract_sid = t13.purchase_contract_sid
         LEFT JOIN s_del_delivery_note t14 ON t8.delivery_note_sid = t14.delivery_note_sid
         LEFT JOIN s_con_account_method_group t15 ON t13.accounts_method_group = t15.sid
    </sql>

    <select id="selectFinPaymentEstimationAdjustBillItemById" parameterType="Long"
            resultMap="FinPaymentEstimationAdjustBillItemResult">
        <include refid="selectFinPaymentEstimationAdjustBillItemVo"/>
        where t.payment_estimation_adjust_bill_item_sid = #{paymentEstimationAdjustBillItemSid}
    </select>

    <select id="selectFinPaymentEstimationAdjustBillItemList"
            parameterType="com.platform.ems.domain.FinPaymentEstimationAdjustBillItem"
            resultMap="FinPaymentEstimationAdjustBillItemResult">
        <include refid="selectFinPaymentEstimationAdjustBillItemVo"/>
        <where>
            <if test="clientId != null  and clientId != ''">
                and t.client_id = #{clientId}
            </if>
            <if test="paymentEstimationAdjustBillSid != null ">
                and t.payment_estimation_adjust_bill_sid =#{paymentEstimationAdjustBillSid}
            </if>
            <if test="materialSid != null ">
                and t.material_sid =#{materialSid}
            </if>
            <if test="sku1Sid != null ">
                and t.sku1_sid =#{sku1Sid}
            </if>
            <if test="sku2Sid != null ">
                and t.sku2_sid =#{sku2Sid}
            </if>
            <if test="barcodeSid != null ">
                and t.barcode_sid =#{barcodeSid}
            </if>
            <if test="materialName != null  and materialName != ''">and
                t.material_name like concat('%', #{materialName}, '%')
            </if>
            <if test="specification != null  and specification != ''">
                and t.specification = #{specification}
            </if>
            <if test="quantityNew != null ">
                and t.quantity_new = #{quantityNew}
            </if>
            <if test="priceNew != null ">
                and t.price_new = #{priceNew}
            </if>
            <if test="priceTaxNew != null ">
                and t.price_tax_new = #{priceTaxNew}
            </if>
            <if test="quantityOld != null ">
                and t.quantity_old = #{quantityOld}
            </if>
            <if test="priceOld != null ">
                and t.price_old = #{priceOld}
            </if>
            <if test="priceTaxOld != null ">
                and t.price_tax_old = #{priceTaxOld}
            </if>
            <if test="itemNum != null ">
                and t.item_num =#{itemNum}
            </if>
            <if test="accountDocumentSid != null ">
                and t.account_document_sid =#{accountDocumentSid}
            </if>
            <if test="accountDocumentCode != null ">
                and t.account_document_code =#{accountDocumentCode}
            </if>
            <if test="bookType != null  and bookType != ''">
                and t.book_type = #{bookType}
            </if>
            <if test="bookSourceCategory != null  and bookSourceCategory != ''">
                and t.book_source_category = #{bookSourceCategory}
            </if>
            <if test="accountItemSid != null ">
                and t.account_item_sid =#{accountItemSid}
            </if>
            <if test="accountItemCode != null ">
                and t.account_item_code =#{accountItemCode}
            </if>
            <if test="creatorAccount != null  and creatorAccount != ''">
                and t.creator_account = #{creatorAccount}
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="dataSourceSys != null  and dataSourceSys != ''">
                and t.data_source_sys = #{dataSourceSys}
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
    </select>

    <!--添加多个-->
    <insert id="inserts">
        insert into s_fin_payment_estimation_adjust_bill_item
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            payment_estimation_adjust_bill_item_sid,
            payment_estimation_adjust_bill_sid,
            material_sid,
            sku1_sid,
            sku2_sid,
            barcode_sid,
            material_name,
            specification,
            quantity_new,
            price_new,
            price_tax_new,
            quantity_old,
            price_old,
            price_tax_old,
            item_num,
            account_document_sid,
            account_document_code,
            book_type,
            book_source_category,
            account_item_sid,
            account_item_code,
            remark,
            creator_account,
            create_date,
            data_source_sys,
        </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                #{item.clientId},
                #{item.paymentEstimationAdjustBillItemSid},
                #{item.paymentEstimationAdjustBillSid},
                #{item.materialSid},
                #{item.sku1Sid},
                #{item.sku2Sid},
                #{item.barcodeSid},
                #{item.materialName},
                #{item.specification},
                #{item.quantityNew},
                #{item.priceNew},
                #{item.priceTaxNew},
                #{item.quantityOld},
                #{item.priceOld},
                #{item.priceTaxOld},
                #{item.itemNum},
                #{item.accountDocumentSid},
                #{item.accountDocumentCode},
                #{item.bookType},
                #{item.bookSourceCategory},
                #{item.accountItemSid},
                #{item.accountItemCode},
                #{item.remark},
                #{item.creatorAccount},
                #{item.createDate},
                #{item.dataSourceSys},
            </trim>
        </foreach>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_fin_payment_estimation_adjust_bill_item
        <trim prefix="SET" suffixOverrides=",">
            material_sid = #{materialSid},
            sku1_sid = #{sku1Sid},
            sku2_sid = #{sku2Sid},
            barcode_sid = #{barcodeSid},
            material_name = #{materialName},
            specification = #{specification},
            quantity_new = #{quantityNew},
            price_new = #{priceNew},
            price_tax_new = #{priceTaxNew},
            quantity_old = #{quantityOld},
            price_old = #{priceOld},
            price_tax_old = #{priceTaxOld},
            item_num = #{itemNum},
            account_document_sid = #{accountDocumentSid},
            account_document_code = #{accountDocumentCode},
            book_type = #{bookType},
            book_source_category = #{bookSourceCategory},
            account_item_sid = #{accountItemSid},
            account_item_code = #{accountItemCode},
            remark = #{remark},
            updater_account = #{updaterAccount},
            update_date = #{updateDate},
            data_source_sys = #{dataSourceSys},
        </trim>
        where payment_estimation_adjust_bill_item_sid = #{paymentEstimationAdjustBillItemSid}
    </update>

</mapper>

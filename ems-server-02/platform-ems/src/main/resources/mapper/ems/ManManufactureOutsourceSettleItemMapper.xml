<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.ManManufactureOutsourceSettleItemMapper">

    <resultMap type="com.platform.ems.domain.ManManufactureOutsourceSettleItem"
               id="ManManufactureOutsourceSettleItemResult">
        <result property="clientId" column="client_id"/>
        <result property="manufactureOutsourceSettleItemSid" column="manufacture_outsource_settle_item_sid"/>
        <result property="manufactureOutsourceSettleSid" column="manufacture_outsource_settle_sid"/>
        <result property="materialSid" column="material_sid"/>
        <result property="manufactureOrderSid" column="manufacture_order_sid"/>
        <result property="manufactureOrderCode" column="manufacture_order_code"/>
        <result property="manufactureOrderProcessSid" column="manufacture_order_process_sid"/>
        <result property="unitBase" column="unit_base"/>
        <result property="settleQuantity" column="settle_quantity"/>
        <result property="inDefectiveQuantity" column="in_defective_quantity"/>
        <result property="outDefectiveQuantity" column="out_defective_quantity"/>
        <result property="defectiveAllowableRate" column="defective_allowable_rate"/>
        <result property="defectiveAllowableQuantity" column="defective_allowable_quantity"/>
        <result property="price" column="price"/>
        <result property="priceTax" column="price_tax"/>
        <result property="costPrice" column="cost_price"/>
        <result property="costPriceTax" column="cost_price_tax"/>
        <result property="taxRate" column="tax_rate"/>
        <result property="itemNum" column="item_num"/>
        <result property="remark" column="remark"/>
        <result property="creatorAccount" column="creator_account"/>
        <result property="createDate" column="create_date"/>
        <result property="updaterAccount" column="updater_account"/>
        <result property="updateDate" column="update_date"/>
        <result property="dataSourceSys" column="data_source_sys"/>
        <result property="manufactureOutsourceSettleCode" column="manufacture_outsource_settle_code"/>
        <result property="vendorSid" column="vendor_sid"/>
        <result property="vendorName" column="vendor_name"/>
        <result property="vendorCode" column="vendor_code"/>
        <result property="plantSid" column="plant_sid"/>
        <result property="plantName" column="plant_name"/>
        <result property="plantCode" column="plant_code"/>
        <result property="materialName" column="material_name"/>
        <result property="materialCode" column="material_code"/>
        <result property="processName" column="process_name"/>
        <result property="receivingQuantity" column="receiving_quantity"/>
        <result property="tobeQuantity" column="tobe_quantity"/>
        <result property="planQuantity" column="plan_quantity"/>
        <result property="documentTypeName" column="document_type_name"/>
        <result property="businessTypeName" column="business_type_name"/>
        <result property="handleStatus" column="handle_status"/>
        <result property="unitBaseName" column="unit_base_name"/>
        <result property="processSid" column="process_sid"/>
        <result property="processBatchNum" column="process_batch_num"/>
        <result property="completeQuantity" column="complete_quantity"/>
        <result property="unitPrice" column="unit_price"/>
        <result property="unitConversionRate" column="unit_conversion_rate"/>
        <result property="freeFlag" column="free_flag"/>
        <result property="unitPriceName" column="unit_price_name"/>
    </resultMap>

    <sql id="selectManManufactureOutsourceSettleItemVo">
        select
        t.client_id,
        t.manufacture_outsource_settle_item_sid,
        t.manufacture_outsource_settle_sid,
        t.material_sid,
        t.material_code,
        t.sku1_sid,
        t.sku1_code,
        t.sku2_sid,
        t.sku2_code,
        t.process_sid,
        t.process_code,
        t.manufacture_order_sid,
        t.manufacture_order_code,
        t.manufacture_order_process_sid,
        t.complete_quantity,
        t.unit_base,
        t.settle_quantity,
        t.in_defective_quantity,
        t.out_defective_quantity,
        (IF(t.defective_allowable_rate IS NULL, t.defective_allowable_rate,
            CAST(t.defective_allowable_rate * 100 AS DECIMAL(4,1)))) AS defective_allowable_rate,
        t.defective_allowable_quantity,
        t.price,
        t.price_tax,
        t.cost_price,
        t.cost_price_tax,
        t.tax_rate,
        t.in_defective_price_tax,
        t.in_defective_price,
        t.out_defective_price_tax,
        t.out_defective_price,
        t.other_deduction_tax,
        t.other_deduction,
        t.defective_quantity,
        t.process_amount_tax,
        t.sum_deduction_tax,
        t.settle_amount_tax,
        t.item_num,
        t.position_desc,
        t.process_desc,
        t.process_picture,
        t.remark,
        t.creator_account,
        t.create_date,
        t.updater_account,
        t.update_date,
        t.data_source_sys,
        t.unit_price,
        t.unit_conversion_rate,
        t.free_flag,
        t.settle_quantity * t.price_tax as amount,
        t.out_defective_quantity * t.cost_price_tax as defective_amount,
        t.settle_quantity * t.price_tax - IFNULL(t.out_defective_quantity * t.cost_price_tax, 0) as amount_payable,
        t.manufacture_outsource_settle_code,
        t1.vendor_sid,
		t1.plant_sid,
        t1.company_sid,
		t1.document_date,
        t1.document_type,
        t1.business_type,
        t1.handle_status,
        t1.purchase_contract_sid,
        t1.purchase_contract_code,
        t2.vendor_code,
		t2.vendor_name,
        IFNULL(t2.short_name, t2.vendor_name) as vendor_short_name,
		t3.plant_code,
        t3.plant_name,
        IFNULL(t3.short_name, t3.plant_name) as plant_short_name,
        t4.material_name,
        t5.name as unit_base_name,
        t6.process_batch_num,
        t6.serial_num,
        t6.item_num as process_item_num,
        t6.quantity AS plan_quantity,
        t7.quantity - IFNULL(t.settle_quantity, 0) AS tobe_quantity,
        t7.quantity AS receiving_quantity,
        t8.nick_name as creator_account_name,
        t9.nick_name as updater_account_name,
        t10.name as document_type_name,
        t11.name as business_type_name,
        t12.name as unit_price_name,
        t13.company_code,
        t13.company_name,
        IFNULL(t13.short_name, t13.company_name) as company_short_name,
        t14.sku_name as sku1_name,
        t15.sku_name as sku2_name,
        t16.process_name
        <include refid="fromVo"/>
    </sql>

    <sql id="fromVo">
        from s_man_manufacture_outsource_settle_item t
        LEFT JOIN s_man_manufacture_outsource_settle t1 ON t1.manufacture_outsource_settle_sid = t.manufacture_outsource_settle_sid
        LEFT JOIN s_bas_vendor t2 ON t2.vendor_sid = t1.vendor_sid
        LEFT JOIN s_bas_plant t3 ON t3.plant_sid = t1.plant_sid
        LEFT JOIN s_bas_material t4 ON t4.material_sid = t.material_sid
        LEFT JOIN s_con_measure_unit t5 ON t5.code = t.unit_base
        LEFT JOIN s_man_manufacture_order_process t6 ON t6.manufacture_order_process_sid = t.manufacture_order_process_sid
        LEFT JOIN s_del_outsource_delivery_note_item t7 ON t7.manufacture_order_process_sid = t.manufacture_order_process_sid
        LEFT JOIN sys_user t8 ON t8.user_name = t.creator_account and t8.client_id = t.client_id
        LEFT JOIN sys_user t9 ON t9.user_name = t.updater_account and t9.client_id = t.client_id
        LEFT JOIN s_con_doc_type_manufacture_outsource_settle t10 ON t10.code = t1.document_type
        LEFT JOIN s_con_bu_type_manufacture_outsource_settle t11 ON t11.code = t1.business_type
        LEFT JOIN s_con_measure_unit t12 ON t12.code = t.unit_price
        LEFT JOIN s_bas_company t13 ON t1.company_sid = t13.company_sid
        LEFT JOIN s_bas_sku t14 ON t.sku1_sid = t14.sku_sid
        LEFT JOIN s_bas_material_sku t14a ON t.material_sid = t14a.material_sid and t.sku1_sid = t14a.sku_sid
        LEFT JOIN s_bas_sku t15 ON t.sku2_sid = t15.sku_sid
        LEFT JOIN s_bas_material_sku t15a ON t.material_sid = t15a.material_sid and t.sku2_sid = t15a.sku_sid
        LEFT JOIN s_man_process t16 ON t.process_sid = t16.process_sid
    </sql>

    <select id="selectManManufactureOutsourceSettleItemById" parameterType="Long"
            resultMap="ManManufactureOutsourceSettleItemResult">
        <include refid="selectManManufactureOutsourceSettleItemVo"/>
        where t.manufacture_outsource_settle_item_sid = #{manufactureOutsourceSettleItemSid}
    </select>

    <sql id="whereVo">
        <where>
            <if test="materialCode != null and materialCode != ''">
                and (<foreach collection="materialCode.split(';')" item="item" separator=" or ">
                t4.material_code like concat('%', #{item}, '%')</foreach>)
            </if>
            <if test="materialName != null and materialName != ''">
                and t4.material_name like concat('%', #{materialName}, '%')
            </if>
            <if test="handleStatus != null and handleStatus != ''">
                and t1.handle_status = #{handleStatus}
            </if>
            <if test="handleStatusList != null and handleStatusList.length >0 ">
                and t1.handle_status in
                (<foreach collection="handleStatusList" item="handleStatus" separator=",">#{handleStatus}</foreach>)
            </if>
            <if test="purchaseContractCode != null and purchaseContractCode != ''">
                and t1.purchase_contract_code like concat('%', #{purchaseContractCode}, '%')
            </if>
            <if test="plantSid != null ">
                and t1.plant_sid = #{plantSid}
            </if>
            <if test="plantSidList != null and plantSidList.length >0 ">
                and t1.plant_sid in
                (<foreach collection="plantSidList" item="plantSid" separator=",">#{plantSid}</foreach>)
            </if>
            <if test="processSid != null ">
                and t.process_sid = #{processSid}
            </if>
            <if test="processSidList != null and processSidList.length >0 ">
                and t.process_sid in
                (<foreach collection="processSidList" item="processSid" separator=",">#{processSid}</foreach>)
            </if>
            <if test="companySid != null ">
                and t1.company_sid = #{companySid}
            </if>
            <if test="companySidList != null and companySidList.length >0 ">
                and t1.company_sid in
                (<foreach collection="companySidList" item="item" separator=",">#{item}</foreach>)
            </if>
            <if test="businessType != null and businessType != ''">
                and t1.business_type = #{businessType}
            </if>
            <if test="businessTypeList != null and businessTypeList.length >0 ">
                and t1.business_type in
                (<foreach collection="businessTypeList" item="businessType" separator=",">#{businessType}</foreach>)
            </if>
            <if test="documentTypeList != null and documentTypeList.length >0 ">
                and t1.document_type in
                (<foreach collection="documentTypeList" item="documentType" separator=",">#{documentType}</foreach>)
            </if>
            <if test="vendorSid != null ">
                and t1.vendor_sid = #{vendorSid}
            </if>
            <if test="vendorSidList != null and vendorSidList.length >0 ">
                and t1.vendor_sid in
                (<foreach collection="vendorSidList" item="vendorSid" separator=",">#{vendorSid}</foreach>)
            </if>
            <if test="manufactureOutsourceSettleCode != null">
                and t.manufacture_outsource_settle_code like concat('%',#{manufactureOutsourceSettleCode}, '%')
            </if>
            <if test="manufactureOutsourceSettleItemSidList != null and manufactureOutsourceSettleItemSidList.length >0 ">
                and t.manufacture_outsource_settle_item_sid in
                (<foreach collection="manufactureOutsourceSettleItemSidList" item="item" separator=",">#{item}</foreach>)
            </if>
            <if test="clientId != null and clientId != ''">
                and t.client_id = #{clientId}
            </if>
            <if test="manufactureOutsourceSettleSid != null ">
                and t.manufacture_outsource_settle_sid = #{manufactureOutsourceSettleSid}
            </if>
            <if test="materialSid != null ">
                and t.material_sid = #{materialSid}
            </if>
            <if test="manufactureOrderSid != null ">
                and t.manufacture_order_sid = #{manufactureOrderSid}
            </if>
            <if test="manufactureOrderCode != null ">
                and t.manufacture_order_code like concat('%',#{manufactureOrderCode}, '%')
            </if>
            <if test="manufactureOrderProcessSid != null ">
                and t.manufacture_order_process_sid = #{manufactureOrderProcessSid}
            </if>
            <if test="unitBase != null and unitBase != ''">
                and (<foreach collection="unitBase.split(';')" item="item" separator=" or ">
                t.unit_base like concat('%', #{item}, '%')</foreach>)
            </if>
            <if test="settleQuantity != null ">
                and t.settle_quantity = #{settleQuantity}
            </if>
            <if test="inDefectiveQuantity != null ">
                and t.in_defective_quantity = #{inDefectiveQuantity}
            </if>
            <if test="outDefectiveQuantity != null ">
                and t.out_defective_quantity = #{outDefectiveQuantity}
            </if>
            <if test="price != null ">
                and t.price = #{price}
            </if>
            <if test="priceTax != null ">
                and t.price_tax = #{priceTax}
            </if>
            <if test="costPrice != null ">
                and t.cost_price = #{costPrice}
            </if>
            <if test="costPriceTax != null ">
                and t.cost_price_tax = #{costPriceTax}
            </if>
            <if test="taxRate != null ">
                and t.tax_rate = #{taxRate}
            </if>
            <if test="itemNum != null ">
                and t.item_num = #{itemNum}
            </if>
            <if test="creatorAccountName != null and creatorAccountName != ''">
                and t8.nick_name like concat('%', #{creatorAccountName}, '%')
            </if>
            <if test="creatorAccount != null and creatorAccount != ''">
                and (<foreach collection="creatorAccount.split(';')" item="item" separator=" or ">
                t.creator_account like concat('%',#{item}, '%')</foreach>)
            </if>
            <if test="creatorAccountList != null and creatorAccountList.length >0 ">
                and t8.nick_name in
                (<foreach collection="creatorAccountList" item="creatorAccount" separator=",">#{creatorAccount}</foreach>)
            </if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="updaterAccount != null and updaterAccount != ''">
                and (<foreach collection="updaterAccount.split(';')" item="item" separator=" or ">
                t.updater_account like concat('%', #{item}, '%')</foreach>)
            </if>
            <if test="updateDate != null ">
                and t.update_date = #{updateDate}
            </if>
            <if test="dataSourceSys != null and dataSourceSys != ''">
                and t.data_source_sys = #{dataSourceSys}
            </if>
            <if test="unitPrice != null and unitPrice != ''">
                and t.unit_price = #{unitPrice}
            </if>
            <if test="unitConversionRate != null ">
                and t.unit_conversion_rate = #{unitConversionRate}
            </if>
            <if test="freeFlag != null and freeFlag != ''">
                and t.free_flag = #{freeFlag}
            </if>
            <if test="params.dataScope != null and params.dataScope!=''">
                ${params.dataScope}
            </if>
        </where>
    </sql>

    <select id="selectManManufactureOutsourceSettleItemList"
            parameterType="com.platform.ems.domain.ManManufactureOutsourceSettleItem"
            resultMap="ManManufactureOutsourceSettleItemResult">
        <include refid="selectManManufactureOutsourceSettleItemVo"/>
        <include refid="whereVo"/>
        ORDER BY t.manufacture_outsource_settle_code DESC, CONVERT (t.material_code USING gbk) ASC, t14a.sort ASC,
        CONVERT (t14.sku_name USING gbk) ASC, CONVERT (t16.process_name USING gbk) ASC
    </select>

    <select id="selectManManufactureOutsourceSettleItemForm"
            parameterType="com.platform.ems.domain.ManManufactureOutsourceSettleItem"
            resultMap="ManManufactureOutsourceSettleItemResult">
        <if test="pageNum == null or pageSize == null">
            SELECT count(0) as page_size
            <include refid="fromVo"/>
        </if>
        <if test="pageNum != null and pageSize != null">
            <include refid="selectManManufactureOutsourceSettleItemVo"/>
        </if>
        <include refid="whereVo"/>
        <if test="pageNum != null and pageSize != null">
            ORDER BY t.manufacture_outsource_settle_code DESC, CONVERT (t.material_code USING gbk) ASC, t14a.sort ASC,
            CONVERT (t14.sku_name USING gbk) ASC, CONVERT (t16.process_name USING gbk) ASC
            LIMIT ${pageBegin},${pageSize}
        </if>
    </select>

    <select id="selectManManufactureOutsourceSettleStatistics"
            parameterType="com.platform.ems.domain.dto.response.form.ManOutsourceSettleStatistics"
            resultType="com.platform.ems.domain.dto.response.form.ManOutsourceSettleStatistics">
        SELECT t.manufacture_outsource_settle_item_sid, t.manufacture_outsource_settle_sid,
               t.material_sid, t.sku1_sid, t.process_sid,
               t.manufacture_outsource_settle_code, t0.vendor_sid,
               t1.material_code, t1.material_name, t1.customer_sid,
               t2.sku_code as sku1_code, t2.sku_name as sku1_name, t3.process_code, t3.process_name,
               t4.vendor_code, t4.vendor_name, IFNULL(t4.short_name,t4.vendor_name) as vendor_short_name,
               t5.customer_code, t5.customer_name, IFNULL(t5.short_name,t5.customer_name) as customer_short_name,
               SUM(t.complete_quantity) as complete_quantity,
               SUM(t.settle_quantity) as settle_quantity,
               SUM(t.defective_quantity) as defective_quantity,
               SUM(t.in_defective_quantity) as in_defective_quantity,
               SUM(t.out_defective_quantity) as out_defective_quantity,
               SUM(t.process_amount_tax) as process_amount_tax,
               SUM(t.sum_deduction_tax) as sum_deduction_tax,
               SUM(t.settle_amount_tax) as settle_amount_tax
        FROM s_man_manufacture_outsource_settle_item t
        LEFT JOIN s_man_manufacture_outsource_settle t0 ON t.manufacture_outsource_settle_sid = t0.manufacture_outsource_settle_sid
        LEFT JOIN s_bas_material t1 ON t.material_sid = t1.material_sid
        LEFT JOIN s_bas_sku t2 ON t.sku1_sid = t2.sku_sid
        LEFT JOIN s_man_process t3 ON t.process_sid = t3.process_sid
        LEFT JOIN s_bas_vendor t4 ON t0.vendor_sid = t4.vendor_sid
        LEFT JOIN s_bas_customer t5 ON t1.customer_sid = t5.customer_sid
        <where>
                AND t0.handle_status = '5'
            <if test="processSid != null ">
                AND t.process_sid = #{processSid}
            </if>
            <if test="processSidList != null and processSidList.length >0 ">
                AND t.process_sid in
                (<foreach collection="processSidList" item="processSid" separator=",">#{processSid}</foreach>)
            </if>
            <if test="documentDateBegin != null and documentDateBegin != ''">
                and t0.document_date &gt;= #{documentDateBegin}
            </if>
            <if test="documentDateEnd != null and documentDateEnd != ''">
                and t0.document_date &lt;= #{documentDateEnd}
            </if>
            <if test="vendorSid != null ">
                AND t0.vendor_sid =#{vendorSid}
            </if>
            <if test="vendorSidList != null and vendorSidList.length >0 ">
                AND t0.vendor_sid in
                (<foreach collection="vendorSidList" item="vendorSid" separator=",">#{vendorSid}</foreach>)
            </if>
            <if test="plantSid != null ">
                AND t0.plant_sid =#{plantSid}
            </if>
            <if test="plantSidList != null and plantSidList.length >0 ">
                AND t0.plant_sid in
                (<foreach collection="plantSidList" item="plantSid" separator=",">#{plantSid}</foreach>)
            </if>
            <if test="materialCode != null and materialCode != ''">
                AND t1.material_code like concat('%', #{materialCode}, '%')
            </if>
        </where>
        GROUP BY t.material_sid, t.sku1_sid, t.process_sid, t0.vendor_sid
        ORDER BY t1.material_code ASC, t2.sku_name ASC, t3.process_name ASC, vendor_short_name ASC
    </select>

    <!--添加多个-->
    <insert id="inserts">
        insert into s_man_manufacture_outsource_settle_item
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            complete_quantity,
            manufacture_outsource_settle_item_sid,
            manufacture_outsource_settle_sid,
            manufacture_outsource_settle_code,
            material_sid,
            material_code,
            sku1_sid,
            sku1_code,
            sku2_sid,
            sku2_code,
            process_sid,
            process_code,
            manufacture_order_sid,
            manufacture_order_code,
            manufacture_order_process_sid,
            unit_base,
            settle_quantity,
            in_defective_quantity,
            out_defective_quantity,
            defective_allowable_rate,
            defective_allowable_quantity,
            price,
            price_tax,
            cost_price,
            cost_price_tax,
            tax_rate,
            in_defective_price_tax,
            in_defective_price,
            out_defective_price_tax,
            out_defective_price,
            other_deduction_tax,
            other_deduction,
            defective_quantity,
            process_amount_tax,
            sum_deduction_tax,
            settle_amount_tax,
            position_desc,
            process_desc,
            process_picture,
            item_num,
            remark,
            creator_account,
            create_date,
            data_source_sys,
            unit_price,
            unit_conversion_rate,
            free_flag,
        </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                #{item.clientId},
                #{item.completeQuantity},
                #{item.manufactureOutsourceSettleItemSid},
                #{item.manufactureOutsourceSettleSid},
                #{item.manufactureOutsourceSettleCode},
                #{item.materialSid},
                #{item.materialCode},
                #{item.sku1Sid},
                #{item.sku1Code},
                #{item.sku2Sid},
                #{item.sku2Code},
                #{item.processSid},
                #{item.processCode},
                #{item.manufactureOrderSid},
                #{item.manufactureOrderCode},
                #{item.manufactureOrderProcessSid},
                #{item.unitBase},
                #{item.settleQuantity},
                #{item.inDefectiveQuantity},
                #{item.outDefectiveQuantity},
                #{item.defectiveAllowableRate},
                #{item.defectiveAllowableQuantity},
                #{item.price},
                #{item.priceTax},
                #{item.costPrice},
                #{item.costPriceTax},
                #{item.taxRate},
                #{item.inDefectivePriceTax},
                #{item.inDefectivePrice},
                #{item.outDefectivePriceTax},
                #{item.outDefectivePrice},
                #{item.otherDeductionTax},
                #{item.otherDeduction},
                #{item.defectiveQuantity},
                #{item.processAmountTax},
                #{item.sumDeductionTax},
                #{item.settleAmountTax},
                #{item.positionDesc},
                #{item.processDesc},
                #{item.processPicture},
                #{item.itemNum},
                #{item.remark},
                #{item.creatorAccount},
                #{item.createDate},
                #{item.dataSourceSys},
                #{item.unitPrice},
                #{item.unitConversionRate},
                #{item.freeFlag},
            </trim>
        </foreach>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_man_manufacture_outsource_settle_item
        <trim prefix="SET" suffixOverrides=",">
            client_id = #{clientId},
            complete_quantity = #{completeQuantity},
            manufacture_outsource_settle_sid = #{manufactureOutsourceSettleSid},
            manufacture_outsource_settle_code = #{manufactureOutsourceSettleCode},
            material_sid = #{materialSid},
            material_code = #{materialCode},
            sku1_sid = #{sku1Sid},
            sku1_code = #{sku1Code},
            sku2_sid = #{sku2Sid},
            sku2_code = #{sku2Code},
            process_sid = #{processSid},
            process_code = #{processCode},
            manufacture_order_sid = #{manufactureOrderSid},
            manufacture_order_code = #{manufactureOrderCode},
            manufacture_order_process_sid = #{manufactureOrderProcessSid},
            unit_base = #{unitBase},
            settle_quantity = #{settleQuantity},
            in_defective_quantity = #{inDefectiveQuantity},
            out_defective_quantity = #{outDefectiveQuantity},
            defective_allowable_rate = #{defectiveAllowableRate},
            defective_allowable_quantity = #{defectiveAllowableQuantity},
            price = #{price},
            price_tax = #{priceTax},
            cost_price = #{costPrice},
            cost_price_tax = #{costPriceTax},
            tax_rate = #{taxRate},
            in_defective_price_tax = #{inDefectivePriceTax},
            in_defective_price = #{inDefectivePrice},
            out_defective_price_tax = #{outDefectivePriceTax},
            out_defective_price = #{outDefectivePrice},
            other_deduction_tax = #{otherDeductionTax},
            other_deduction = #{otherDeduction},
            defective_quantity = #{defectiveQuantity},
            process_amount_tax = #{processAmountTax},
            sum_deduction_tax = #{sumDeductionTax },
            settle_amount_tax = #{settleAmountTax},
            position_desc = #{positionDesc},
            process_desc = #{processDesc},
            process_picture = #{processPicture},
            item_num = #{itemNum},
            remark = #{remark},
            updater_account = #{updaterAccount},
            update_date = #{updateDate},
            data_source_sys = #{dataSourceSys},
            unit_price = #{unitPrice},
            unit_conversion_rate = #{unitConversionRate},
            free_flag = #{freeFlag},
        </trim>
        where manufacture_outsource_settle_item_sid = #{manufactureOutsourceSettleItemSid}
    </update>

    <!--更新多个-->
    <update id="updatesAllById">
        <foreach collection="list" item="o" separator=";">
            update s_man_manufacture_outsource_settle_item
            <trim prefix="SET" suffixOverrides=",">
                client_id = #{o.clientId},
                manufacture_outsource_settle_sid = #{o.manufactureOutsourceSettleSid},
                manufacture_outsource_settle_code = #{o.manufactureOutsourceSettleCode},
                material_sid = #{o.materialSid},
                material_code = #{o.materialCode},
                sku1_sid = #{o.sku1Sid},
                sku1_code = #{o.sku1Code},
                sku2_sid = #{o.sku2Sid},
                sku2_code = #{o.sku2Code},
                process_sid = #{o.processSid},
                process_code = #{o.processCode},
                manufacture_order_sid = #{o.manufactureOrderSid},
                manufacture_order_code = #{o.manufactureOrderCode},
                manufacture_order_process_sid = #{o.manufactureOrderProcessSid},
                unit_base = #{o.unitBase},
                settle_quantity = #{o.settleQuantity},
                in_defective_quantity = #{o.inDefectiveQuantity},
                out_defective_quantity = #{o.outDefectiveQuantity},
                defective_allowable_rate = #{o.defectiveAllowableRate},
                defective_allowable_quantity = #{o.defectiveAllowableQuantity},
                price = #{o.price},
                price_tax = #{o.priceTax},
                cost_price = #{o.costPrice},
                cost_price_tax = #{o.costPriceTax},
                tax_rate = #{o.taxRate},
                in_defective_price_tax = #{o.inDefectivePriceTax},
                in_defective_price = #{o.inDefectivePrice},
                out_defective_price_tax = #{o.outDefectivePriceTax},
                out_defective_price = #{o.outDefectivePrice},
                other_deduction_tax = #{o.otherDeductionTax},
                other_deduction = #{o.otherDeduction},
                defective_quantity = #{o.defectiveQuantity},
                process_amount_tax = #{o.processAmountTax},
                sum_deduction_tax = #{o.sumDeductionTax },
                settle_amount_tax = #{o.settleAmountTax},
                position_desc = #{o.positionDesc},
                process_desc = #{o.processDesc},
                process_picture = #{o.processPicture},
                item_num = #{o.itemNum},
                remark = #{o.remark},
                updater_account = #{o.updaterAccount},
                update_date = #{o.updateDate},
                data_source_sys = #{o.dataSourceSys},
                unit_price = #{o.unitPrice},
                unit_conversion_rate = #{o.unitConversionRate},
                free_flag = #{o.freeFlag},
            </trim>
            where manufacture_outsource_settle_item_sid = #{o.manufactureOutsourceSettleItemSid}
        </foreach>
    </update>

</mapper>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.BasStorehouseLocationMapper">

    <resultMap type="com.platform.ems.domain.BasStorehouseLocation" id="BasStorehouseLocationResult">
        <result property="clientId" column="client_id"/>
        <result property="storehouseLocationSid" column="storehouse_location_sid"/>
        <result property="storehouseSid" column="storehouse_sid"/>
        <result property="locationCode" column="location_code"/>
        <result property="locationName" column="location_name"/>
        <result property="administrator" column="administrator"/>
        <result property="isWm" column="is_wm"/>
        <result property="isVirtual" column="is_virtual"/>
        <result property="usableType" column="usable_type"/>
        <result property="address" column="address"/>
        <result property="locationType" column="location_type"/>
        <result property="materialFlag" column="material_flag"/>
        <result property="otherSystemStorehouseCode" column="other_system_storehouse_code"/>
        <result property="remark" column="remark"/>
        <result property="status" column="status"/>
        <result property="handleStatus" column="handle_status"/>
        <result property="creatorAccount" column="creator_account"/>
        <result property="createDate" column="create_date"/>
        <result property="updaterAccount" column="updater_account"/>
        <result property="updateDate" column="update_date"/>
        <result property="confirmerAccount" column="confirmer_account"/>
        <result property="creatorAccountName" column="creator_account_name"/>
        <result property="confirmDate" column="confirm_date"/>
        <result property="dataSourceSys" column="data_source_sys"/>
        <result property="updaterAccountName" column="updater_account_name"/>
        <result property="confirmerAccountName" column="confirmer_account_name"/>
        <result property="storehouseCode" column="storehouse_code"/>
        <result property="storehouseName" column="storehouse_name"/>
        <result property="administratorName" column="administrator_name"/>
    </resultMap>

    <select id="selectBasStorehouseLocationById" parameterType="Long" resultMap="BasStorehouseLocationResult">
        <include refid="selectBasStorehouseLocationVo"/>
        where t.client_id = #{clientId}
    </select>


    <select id="selectBasStorehouseLocationList" parameterType="com.platform.ems.domain.BasStorehouseLocation"
            resultMap="BasStorehouseLocationResult">
        <include refid="selectBasStorehouseLocationVo"/>
        <where>
            <if test="storehouseLocationSid != null  and storehouseLocationSid != ''">
                and t.storehouse_location_sid in (
                <foreach collection="storehouseLocationSid.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="storehouseSid != null  and storehouseSid != ''">
                and t.storehouse_sid = #{storehouseSid}
            </if>
            <if test="locationCode != null  and locationCode != ''">and t.location_code like concat('%',
                #{locationCode}, '%')
            </if>
            <if test="locationName != null  and locationName != ''">and t.location_name like concat('%',
                #{locationName}, '%')
            </if>
            <if test="storehouseCode != null  and storehouseCode != ''">and t1.storehouse_code like concat('%',
                #{storehouseCode}, '%')
            </if>
            <if test="storehouseName != null  and storehouseName != ''">and t1.storehouse_name like concat('%',
                #{storehouseName}, '%')
            </if>
            <if test="administrator != null  and administrator != ''">
                and t.administrator in (
                <foreach collection="administrator.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="administratorList != null  and administratorList.length >0">and t.administrator in
                (<foreach collection="administratorList" item="administrator" separator=",">#{administrator}</foreach>)
            </if>
            <if test="isWm != null  and isWm != ''">
                and t.is_wm in (
                <foreach collection="isWm.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="isVirtual != null  and isVirtual != ''">
                and t.is_virtual in (
                <foreach collection="isVirtual.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="usableType != null and usableType != ''">
                and t.usable_type = #{usableType}
            </if>
            <if test="address != null  and address != ''">
                and t.address in (
                <foreach collection="address.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="locationType != null  and locationType != ''">
                and t.location_type in (
                <foreach collection="locationType.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="handleStatus != null  and handleStatus != ''">
                and t.handle_status in (
                <foreach collection="handleStatus.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="handleStatusList != null  and handleStatusList.length >0">and t.handle_status in
                (<foreach collection="handleStatusList" item="handleStatus" separator=",">#{handleStatus}</foreach>)
            </if>
            <if test="status != null  and status != ''">
                and t.status in (
                <foreach collection="status.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="creatorAccount != null  and creatorAccount != ''">
                and t2.nick_name like concat('%', #{creatorAccount}, '%')
            </if>
            <if test="updaterAccount != null  and updaterAccount != ''">
                and t.updater_account in (
                <foreach collection="updaterAccount.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="updateDate != null ">and t.update_date = #{updateDate}</if>
            <if test="confirmerAccount != null  and confirmerAccount != ''">
                and t.confirmer_account in (
                <foreach collection="confirmerAccount.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="confirmDate != null ">and t.confirm_date = #{confirmDate}</if>
            <if test="beginTime != null and beginTime!=''">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null and endTime!=''">
                and date_format(t.create_date,'%y%m%d') &lt;= date_format(#{endTime},'%y%m%d')
            </if>
            <if test="dataSourceSys != null  and dataSourceSys != ''">
                and t.data_source_sys in (
                <foreach collection="dataSourceSys.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
        </where>
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_bas_storehouse_location
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            storehouse_location_sid,
            storehouse_sid,
            location_code,
            location_name,
            administrator,
            is_wm,
            is_virtual,
            usable_type,
            address,
            location_type,
            material_flag,
            other_system_storehouse_code,
            remark,
            status,
            handle_status,
            creator_account,
            create_date,
            updater_account,
            update_date,
            confirmer_account,
            confirm_date,
            data_source_sys,
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <foreach collection="list" item="o" separator=",">
                #{clientId},
                #{storehouseLocationSid},
                #{storehouseSid},
                #{locationCode},
                #{locationName},
                #{administrator},
                #{isWm},
                #{isVirtual},
                #{usableType},
                #{address},
                #{locationType},
                #{materialFlag},
                #{otherSystemStorehouseCode},
                #{remark},
                #{status},
                #{handleStatus},
                #{creatorAccount},
                #{createDate},
                #{updaterAccount},
                #{updateDate},
                #{confirmerAccount},
                #{confirmDate},
                #{dataSourceSys},
            </foreach>
        </trim>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_bas_storehouse_location
        <trim prefix="SET" suffixOverrides=",">
            storehouse_location_sid = #{storehouseLocationSid},
            storehouse_sid = #{storehouseSid},
            location_code = #{locationCode},
            location_name = #{locationName},
            administrator = #{administrator},
            is_wm = #{isWm},
            is_virtual = #{isVirtual},
            usable_type = #{usableType},
            address = #{address},
            location_type = #{locationType},
            material_flag = #{materialFlag},
            other_system_storehouse_code = #{otherSystemStorehouseCode},
            remark = #{remark},
            status = #{status},
            stock_type= #{stockType},
            handle_status = #{handleStatus},
            updater_account = #{updaterAccount},
            update_date = #{updateDate},
            confirmer_account = #{confirmerAccount},
            confirm_date = #{confirmDate},
            data_source_sys = #{dataSourceSys},
        </trim>
        where client_id = #{clientId}
    </update>

    <!--更新多个-->
    <update id="updatesAllById">
        <foreach collection="list" item="o" separator=";">
            update s_bas_storehouse_location
            <trim prefix="SET" suffixOverrides=",">
                storehouse_location_sid = #{storehouseLocationSid},
                storehouse_sid = #{storehouseSid},
                location_code = #{locationCode},
                location_name = #{locationName},
                administrator = #{administrator},
                is_wm = #{isWm},
                is_virtual = #{isVirtual},
                usable_type = #{usableType},
                address = #{address},
                location_type = #{locationType},
                material_flag = #{materialFlag},
                other_system_storehouse_code = #{otherSystemStorehouseCode},
                remark = #{remark},
                status = #{status},
                handle_status = #{handleStatus},
                updater_account = #{updaterAccount},
                update_date = #{updateDate},
                confirmer_account = #{confirmerAccount},
                confirm_date = #{confirmDate},
                data_source_sys = #{dataSourceSys},
            </trim>
            where client_id = #{clientId}
        </foreach>
    </update>


    <sql id="selectBasStorehouseLocationVo">
        select t.client_id,
               t.storehouse_location_sid,
               t.stock_type,
               t.storehouse_sid,
               t.location_code,
               t.location_name,
               t.administrator,
               t5.nick_name AS administrator_name,
               t.is_wm,
               t.is_virtual,
               t.usable_type,
               t.address,
               t.location_type,
               t.material_flag,
               t.other_system_storehouse_code,
               t.remark,
               t.status,
               t.handle_status,
               t.creator_account,
               t.create_date,
               t.updater_account,
               t.update_date,
               t.confirmer_account,
               t.confirm_date,
               t.data_source_sys,
               t1.storehouse_code,
               t1.storehouse_name,
               t2.nick_name AS creator_account_name,
               t3.nick_name AS updater_account_name,
               t4.nick_name AS confirmer_account_name
        from s_bas_storehouse_location t
        LEFT JOIN s_bas_storehouse t1 on t.storehouse_sid = t1.storehouse_sid
         LEFT JOIN sys_user t2 on t.creator_account = t2.user_name
         LEFT JOIN sys_user t3 on t.updater_account = t3.user_name
         LEFT JOIN sys_user t4 on t.confirmer_account = t4.user_name
        LEFT JOIN sys_user t5 on t.administrator = t5.user_name
    </sql>

    <delete id="deleteBasStorehouseLocationByIds" parameterType="Long">
        delete from s_bas_storehouse_location where storehouse_sid in
        <foreach item="storehouseSid" collection="array" open="(" separator="," close=")">
            #{storehouseSid}
        </foreach>
    </delete>

</mapper>

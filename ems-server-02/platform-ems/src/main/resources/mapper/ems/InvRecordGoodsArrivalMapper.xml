<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.InvRecordGoodsArrivalMapper">

    <resultMap type="com.platform.ems.domain.InvRecordGoodsArrival" id="InvRecordGoodsArrivalResult">
                    <result property="clientId" column="client_id"/>
                    <result property="goodsArrivalSid" column="goods_arrival_sid"/>
                    <result property="goodsArrivalCode" column="goods_arrival_code"/>
                    <result property="storehouseSid" column="storehouse_sid"/>
                    <result property="arrivalDate" column="arrival_date"/>
                    <result property="supplierDeliveryCode" column="supplier_delivery_code"/>
                    <result property="carrier" column="carrier"/>
                    <result property="carrierName" column="carrier_name"/>
                    <result property="carrierNoteCode" column="carrier_note_code"/>
                    <result property="remark" column="remark"/>
                    <result property="handleStatus" column="handle_status"/>
                    <result property="creatorAccount" column="creator_account"/>
                    <result property="createDate" column="create_date"/>
                    <result property="updaterAccount" column="updater_account"/>
                    <result property="updateDate" column="update_date"/>
                    <result property="confirmerAccount" column="confirmer_account"/>
                    <result property="confirmDate" column="confirm_date"/>
                    <result property="dataSourceSys" column="data_source_sys"/>
                <result property="creatorAccountName" column="creator_account_name"/>
        <result property="updaterAccountName" column="updater_account_name"/>
        <result property="confirmerAccountName" column="confirmer_account_name"/>
    </resultMap>

    <sql id="selectInvRecordGoodsArrivalVo">
        select t.client_id,
        t.goods_arrival_sid,
        t.goods_arrival_code,
        t.storehouse_sid,
        t.arrival_date,
        t.supplier_delivery_code,
        t.carrier,
        t.carrier_note_code,
        t.remark,
        t.handle_status,
        t.creator_account,
        t.create_date,
        t.updater_account,
        t.update_date,
        t.confirmer_account,
        t.confirm_date,
        t.data_source_sys ,
        t2.nick_name AS creator_account_name,
        t3.nick_name AS updater_account_name,
        t4.nick_name AS confirmer_account_name,
        t5.storehouse_name,
        t8.vendor_name as carrier_name
        from s_inv_record_goods_arrival t
        LEFT JOIN sys_user t2 ON t2.user_name = t.creator_account
        LEFT JOIN sys_user t3 ON t3.user_name = t.updater_account
        LEFT JOIN sys_user t4 ON t4.user_name = t.confirmer_account
        LEFT JOIN s_bas_storehouse t5 ON t5.storehouse_sid = t.storehouse_sid
        LEFT JOIN s_inv_record_goods_arrival_item t6 ON t6.goods_arrival_sid = t.goods_arrival_sid
        left join s_pur_purchase_order t7 on t7.purchase_order_sid=t6.purchase_order_sid
        left join s_bas_vendor t8 on t8.vendor_sid=t.carrier
    </sql>

    <select id="selectInvRecordGoodsArrivalById" parameterType="Long" resultMap="InvRecordGoodsArrivalResult">
        <include refid="selectInvRecordGoodsArrivalVo"/>
        where t.goods_arrival_sid = #{goodsArrivalSid}
        group by t.goods_arrival_sid
    </select>


    <select id="selectInvRecordGoodsArrivalList" parameterType="com.platform.ems.domain.InvRecordGoodsArrival"
            resultMap="InvRecordGoodsArrivalResult">
        <include refid="selectInvRecordGoodsArrivalVo"/>
        <where>
            <if test="goodsArrivalCode != null and goodsArrivalCode !=''" >
                and t.goods_arrival_code like concat('%',#{goodsArrivalCode}, '%')
            </if>
            <if test="productSeasonSidList != null and productSeasonSidList.length >0 ">
                and t7.product_season_sid in
                (<foreach collection="productSeasonSidList" item="productSeasonSid" separator=",">#{productSeasonSid}</foreach>)
            </if>
            <if test="companySidList != null and companySidList.length >0 ">
                and t7.company_sid in
                (<foreach collection="companySidList" item="companySid" separator=",">#{companySid}</foreach>)
            </if>
            <if test="vendorSidList != null and vendorSidList.length >0 ">
                and t7.vendor_sid in
                (<foreach collection="vendorSidList" item="vendorSid" separator=",">#{vendorSid}</foreach>)
            </if>
            <if test="purchaseOrderCode != null">
                and t7.purchase_order_code like concat('%',#{purchaseOrderCode}, '%')
            </if>
            <if test="buyerList != null and buyerList.length >0 ">
                and t7.buyer in
                (<foreach collection="buyerList" item="item" separator=",">#{item}</foreach>)
            </if>
            <if test="handleStatusList != null and handleStatusList.length >0 ">
                and t.handle_status in
                (<foreach collection="handleStatusList" item="handleStatus" separator=",">#{handleStatus}</foreach>)
            </if>
            <if test="creatorAccountList != null and creatorAccountList.length >0 ">
                and t.confirmer_account in
                (<foreach collection="creatorAccountList" item="item" separator=",">#{item}</foreach>)
            </if>
            <if test="beginTime != null">
                and date_format(t.create_date,'%y%m%d') &gt;= date_format(#{beginTime},'%y%m%d')
            </if>
            <if test="endTime != null">
                and date_format(t.create_date,'%y%m%d') &lt;=date_format(#{endTime},'%y%m%d')
            </if>
            <if test="arrivalDateStart != null">
                and date_format(t.arrival_date,'%y%m%d') &gt;= date_format(#{arrivalDateStart},'%y%m%d')
            </if>
            <if test="arrivalDateEnd != null">
                and date_format(t.arrival_date,'%y%m%d') &lt;=date_format(#{arrivalDateEnd},'%y%m%d')
            </if>
        </where>
        group by t.goods_arrival_sid
        order by t.goods_arrival_code desc
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_inv_record_goods_arrival
        <trim prefix="(" suffix=")" suffixOverrides=",">
                                                client_id,
                                                                goods_arrival_sid,
                                                                goods_arrival_code,
                                                                storehouse_sid,
                                                                arrival_date,
                                                                supplier_delivery_code,
                                                                carrier,
                                                                carrier_name,
                                                                carrier_note_code,
                                                                remark,
                                                                handle_status,
                                                                creator_account,
                                                                create_date,
                                                                updater_account,
                                                                update_date,
                                                                confirmer_account,
                                                                confirm_date,
                                                                data_source_sys,
                                    </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                                                            #{item.clientId},
                                                                                                                    #{item.goodsArrivalCode},
                                                                                #{item.storehouseSid},
                                                                                #{item.arrivalDate},
                                                                                #{item.supplierDeliveryCode},
                                                                                #{item.carrier},
                                                                                #{item.carrierName},
                                                                                #{item.carrierNoteCode},
                                                                                #{item.remark},
                                                                                #{item.handleStatus},
                                                                                #{item.creatorAccount},
                                                                                #{item.createDate},
                                                                                #{item.updaterAccount},
                                                                                #{item.updateDate},
                                                                                #{item.confirmerAccount},
                                                                                #{item.confirmDate},
                                                                                #{item.dataSourceSys},
                                                </trim>
        </foreach>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_inv_record_goods_arrival
        <trim prefix="SET" suffixOverrides=",">
                                                client_id = #{clientId},
                                                                goods_arrival_sid = #{goodsArrivalSid},
                                                                goods_arrival_code = #{goodsArrivalCode},
                                                                storehouse_sid = #{storehouseSid},
                                                                arrival_date = #{arrivalDate},
                                                                supplier_delivery_code = #{supplierDeliveryCode},
                                                                carrier = #{carrier},
                                                                carrier_name = #{carrierName},
                                                                carrier_note_code = #{carrierNoteCode},
                                                                remark = #{remark},
                                                                handle_status = #{handleStatus},
                                                                creator_account = #{creatorAccount},
                                                                create_date = #{createDate},
                                                                updater_account = #{updaterAccount},
                                                                update_date = #{updateDate},
                                                                confirmer_account = #{confirmerAccount},
                                                                confirm_date = #{confirmDate},
                                                                data_source_sys = #{dataSourceSys},
                                    </trim>
        where goods_arrival_sid = #{goodsArrivalSid}
    </update>

    <!--更新多个-->
    <update id="updatesAllById">
        <foreach collection="list" item="o" separator=";">
            update s_inv_record_goods_arrival
            <trim prefix="SET" suffixOverrides=",">
                                                            client_id = #{clientId},
                                                                                goods_arrival_sid = #{goodsArrivalSid},
                                                                                goods_arrival_code = #{goodsArrivalCode},
                                                                                storehouse_sid = #{storehouseSid},
                                                                                arrival_date = #{arrivalDate},
                                                                                supplier_delivery_code = #{supplierDeliveryCode},
                                                                                carrier = #{carrier},
                                                                                carrier_name = #{carrierName},
                                                                                carrier_note_code = #{carrierNoteCode},
                                                                                remark = #{remark},
                                                                                handle_status = #{handleStatus},
                                                                                creator_account = #{creatorAccount},
                                                                                create_date = #{createDate},
                                                                                updater_account = #{updaterAccount},
                                                                                update_date = #{updateDate},
                                                                                confirmer_account = #{confirmerAccount},
                                                                                confirm_date = #{confirmDate},
                                                                                data_source_sys = #{dataSourceSys},
                                                </trim>
            where goods_arrival_sid = #{goodsArrivalSid}
        </foreach>
    </update>

</mapper>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.TecBomAttachmentMapper">

    <resultMap type="com.platform.ems.domain.TecBomAttachment" id="TecBomAttachmentResult">
        <result property="clientId"    column="client_id"    />
        <result property="bomAttachmentSid"    column="bom_attachment_sid"    />
        <result property="bomSid"    column="bom_sid"    />
        <result property="fileType"    column="file_type"    />
        <result property="fileName"    column="file_name"    />
        <result property="filePath"    column="file_path"    />
        <result property="remark"    column="remark"    />
        <result property="creatorAccount"    column="creator_account"    />
        <result property="createDate"    column="create_date"    />
        <result property="updaterAccount"    column="updater_account"    />
        <result property="updateDate"    column="update_date"    />
        <result property="dataSourceSys"    column="data_source_sys"    />
    </resultMap>

    <select id="selectTecBomAttachmentById" parameterType="Long" resultMap="TecBomAttachmentResult">
        <include refid="selectTecBomAttachmentVo"/>
        where t.bom_attachment_sid = #{bomAttachmentSid}
    </select>

    <select id="selectAttachmentByBomSid" parameterType="Long" resultMap="TecBomAttachmentResult">
        <include refid="selectTecBomAttachmentVo"/>
        where t.bom_sid = #{bomSid}
    </select>

    <select id="selectTecBomAttachmentList" parameterType="com.platform.ems.domain.TecBomAttachment" resultMap="TecBomAttachmentResult">
        <include refid="selectTecBomAttachmentVo"/>
        <where>
            <if test="clientId != null  and clientId != ''">
                and  t.client_id in (
                <foreach collection="clientId.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="bomSid != null  and bomSid != ''">
                and  t.bom_sid =#{bomSid}
            </if>
            <if test="fileType != null  and fileType != ''">
                and  t.file_type in (
                <foreach collection="fileType.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="fileName != null  and fileName != ''"> and t.file_name like concat('%', #{fileName}, '%')</if>
            <if test="filePath != null  and filePath != ''">
                and  t.file_path in (
                <foreach collection="filePath.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="creatorAccount != null  and creatorAccount != ''">
                and  t.creator_account in (
                <foreach collection="creatorAccount.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="createDate != null "> and t.create_date = #{createDate}</if>
            <if test="updaterAccount != null  and updaterAccount != ''">
                and  t.updater_account in (
                <foreach collection="updaterAccount.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
            <if test="updateDate != null "> and t.update_date = #{updateDate}</if>
            <if test="dataSourceSys != null  and dataSourceSys != ''">
                and  t.data_source_sys in (
                <foreach collection="dataSourceSys.split(';')" item="item" separator=",">
                    #{item}
                </foreach>
                )
            </if>
        </where>
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_tec_bom_attachment
        <trim prefix="(" suffix=")" suffixOverrides=",">
            client_id,
            bom_attachment_sid,
            bom_sid,
            file_type,
            file_name,
            file_path,
            remark,
            creator_account,
            create_date,
            updater_account,
            update_date,
            data_source_sys,
        </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                #{item.clientId},
                #{item.bomAttachmentSid},
                #{item.bomSid},
                #{item.fileType},
                #{item.fileName},
                #{item.filePath},
                #{item.remark},
                #{item.creatorAccount},
                #{item.createDate},
                #{item.updaterAccount},
                #{item.updateDate},
                #{item.dataSourceSys},
            </trim>
        </foreach>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_tec_bom_attachment
        <trim prefix="SET" suffixOverrides=",">
            client_id = #{clientId},
            bom_sid = #{bomSid},
            file_type = #{fileType},
            file_name = #{fileName},
            file_path = #{filePath},
            remark = #{remark},
            creator_account = #{creatorAccount},
            create_date = #{createDate},
            updater_account = #{updaterAccount},
            update_date = #{updateDate},
            data_source_sys = #{dataSourceSys},
        </trim>
        where bom_attachment_sid = #{bomAttachmentSid}
    </update>

    <!--更新多个-->
    <update id="updatesAllById">
        <foreach collection="list" item="o" separator=";">
            update s_tec_bom_attachment
            <trim prefix="SET" suffixOverrides=",">
                client_id = #{clientId},
                bom_sid = #{bomSid},
                file_type = #{fileType},
                file_name = #{fileName},
                file_path = #{filePath},
                remark = #{remark},
                creator_account = #{creatorAccount},
                create_date = #{createDate},
                updater_account = #{updaterAccount},
                update_date = #{updateDate},
                data_source_sys = #{dataSourceSys},
            </trim>
            where bom_attachment_sid = #{bomAttachmentSid}
        </foreach>
    </update>

    <delete id="deleteAttachmentByBomId" parameterType="Long">
        delete from s_tec_bom_attachment where bom_sid = #{bomSid}
    </delete>


    <sql id="selectTecBomAttachmentVo">
        select t.client_id,
        t.bom_attachment_sid,
        t.bom_sid,
        t.file_type,
        t.file_name,
        t.file_path,
        t.remark,
        t.creator_account,
        t.create_date,
        t.updater_account,
        t.update_date,
        t.data_source_sys,
        t1.name AS file_type_name,
        t2.nick_name AS creator_account_name
        from s_tec_bom_attachment t
        LEFT JOIN s_con_file_type t1 on t1.code = t.file_type
        LEFT JOIN sys_user t2 on t.creator_account = t2.user_name
    </sql>


</mapper>

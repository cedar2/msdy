<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.platform.ems.mapper.InvReserveInventoryMapper">

    <resultMap type="com.platform.ems.domain.InvReserveInventory" id="InvReserveInventoryResult">
                    <result property="clientId" column="client_id"/>
                    <result property="reserveStockSid" column="reserve_stock_sid"/>
                    <result property="materialSid" column="material_sid"/>
                    <result property="sku1Sid" column="sku1_sid"/>
                    <result property="sku2Sid" column="sku2_sid"/>
                    <result property="barcodeSid" column="barcode_sid"/>
                    <result property="storehouseSid" column="storehouse_sid"/>
                    <result property="storehouseLocationSid" column="storehouse_location_sid"/>
                    <result property="reserveType" column="reserve_type"/>
                    <result property="quantity" column="quantity"/>
                    <result property="unitBase" column="unit_base"/>
                    <result property="businessOrderSid" column="business_order_sid"/>
                    <result property="businessOrderCode" column="business_order_code"/>
                    <result property="businessOrderItemSid" column="business_order_item_sid"/>
                    <result property="businessOrderItemNum" column="business_order_item_num"/>
                    <result property="materialRequisitionSid" column="material_requisition_sid"/>
                    <result property="materialRequisitionCode" column="material_requisition_code"/>
                    <result property="materialRequisitionItemSid" column="material_requisition_item_sid"/>
                    <result property="materialRequisitionItemNum" column="material_requisition_item_num"/>
                    <result property="deliveryNoteSid" column="delivery_note_sid"/>
                    <result property="deliveryNoteCode" column="delivery_note_code"/>
                    <result property="deliveryNoteItemSid" column="delivery_note_item_sid"/>
                    <result property="deliveryNoteItemNum" column="delivery_note_item_num"/>
                    <result property="salesOrderSid" column="sales_order_sid"/>
                    <result property="salesOrderCode" column="sales_order_code"/>
                    <result property="salesOrderItemSid" column="sales_order_item_sid"/>
                    <result property="salesOrderItemNum" column="sales_order_item_num"/>
                    <result property="purchaseOrderSid" column="purchase_order_sid"/>
                    <result property="purchaseOrderCode" column="purchase_order_code"/>
                    <result property="purchaseOrderItemSid" column="purchase_order_item_sid"/>
                    <result property="purchaseOrderItemNum" column="purchase_order_item_num"/>
                    <result property="inventoryTransferSid" column="inventory_transfer_sid"/>
                    <result property="inventoryTransferCode" column="inventory_transfer_code"/>
                    <result property="inventoryTransferItemSid" column="inventory_transfer_item_sid"/>
                    <result property="inventoryTransferItemNum" column="inventory_transfer_item_num"/>
                    <result property="goodIssueNoteSid" column="good_issue_note_sid"/>
                    <result property="goodIssueNoteCode" column="good_issue_note_code"/>
                    <result property="goodIssueNoteItemSid" column="good_issue_note_item_sid"/>
                    <result property="goodIssueNoteItemNum" column="good_issue_note_item_num"/>
                    <result property="manufactureOrderSid" column="manufacture_order_sid"/>
                    <result property="manufactureOrderCode" column="manufacture_order_code"/>
                    <result property="remark" column="remark"/>
                    <result property="creatorAccount" column="creator_account"/>
                    <result property="createDate" column="create_date"/>
                    <result property="updaterAccount" column="updater_account"/>
                    <result property="updateDate" column="update_date"/>
                    <result property="confirmerAccount" column="confirmer_account"/>
                    <result property="confirmDate" column="confirm_date"/>
                    <result property="dataSourceSys" column="data_source_sys"/>
                <result property="creatorAccountName" column="creator_account_name"/>
        <result property="updaterAccountName" column="updater_account_name"/>
        <result property="confirmerAccountName" column="confirmer_account_name"/>
    </resultMap>

    <sql id="selectInvReserveInventoryVo">
select t.client_id, t.reserve_stock_sid, t.material_sid, t.sku1_sid, t.sku2_sid, t.barcode_sid, t.storehouse_sid, t.storehouse_location_sid, t.reserve_type, t.quantity, t.unit_base, t.business_order_sid, t.business_order_code, t.business_order_item_sid, t.business_order_item_num, t.material_requisition_sid, t.material_requisition_code, t.material_requisition_item_sid, t.material_requisition_item_num, t.delivery_note_sid, t.delivery_note_code, t.delivery_note_item_sid, t.delivery_note_item_num, t.sales_order_sid, t.sales_order_code, t.sales_order_item_sid, t.sales_order_item_num, t.purchase_order_sid, t.purchase_order_code, t.purchase_order_item_sid, t.purchase_order_item_num, t.inventory_transfer_sid, t.inventory_transfer_code, t.inventory_transfer_item_sid, t.inventory_transfer_item_num, t.good_issue_note_sid, t.good_issue_note_code, t.good_issue_note_item_sid, t.good_issue_note_item_num, t.manufacture_order_sid, t.manufacture_order_code, t.remark, t.creator_account, t.create_date, t.updater_account, t.update_date, t.confirmer_account, t.confirm_date, t.data_source_sys ,t2.nick_name AS creator_account_name,t3.nick_name AS updater_account_name,t4.nick_name AS confirmer_account_name from s_inv_reserve_inventory t
        LEFT JOIN sys_user t2 ON t2.user_name = t.creator_account AND t2.client_id = t.client_id
        LEFT JOIN sys_user t3 ON t3.user_name = t.updater_account AND t3.client_id = t.client_id
        LEFT JOIN sys_user t4 ON t4.user_name = t.confirmer_account AND t4.client_id = t.client_id
    </sql>

    <sql id="getInfo">
    select t.client_id,
    t.reserve_stock_sid,
    t.material_sid,
    t.sku1_sid,
    t.sku2_sid,
    t.barcode_sid,
    t.storehouse_sid,
    t.storehouse_location_sid,
    t.reserve_type,
    t.quantity,
    t.unit_base,
    t.business_order_sid,
    t.business_order_code,
    t.business_order_item_sid,
    t.business_order_item_num,
    t.material_requisition_sid,
    t.material_requisition_code,
    t.material_requisition_item_sid,
    t.material_requisition_item_num,
    t.delivery_note_sid,
    t.delivery_note_code,
    t.delivery_note_item_sid,
    t.delivery_note_item_num,
    t.sales_order_sid,
    t.sales_order_code,
    t.sales_order_item_sid,
    t.sales_order_item_num,
    t.purchase_order_sid,
    t.purchase_order_code,
    t.purchase_order_item_sid,
    t.purchase_order_item_num,
    t.inventory_transfer_sid,
    t.inventory_transfer_code,
    t.inventory_transfer_item_sid,
    t.inventory_transfer_item_num,
    t.good_issue_note_sid,
    t.good_issue_note_code,
    t.good_issue_note_item_sid,
    t.good_issue_note_item_num,
    t.manufacture_order_sid,
    t.manufacture_order_code,
    t.remark,
    t.creator_account,
    t.create_date,
    t.updater_account,
    t.update_date,
    t.confirmer_account,
    t.confirm_date,
    t.data_source_sys,
    t1.material_name,
    t1.material_code,
    t2.sku_name AS sku1_name,
    t3.sku_name AS sku2_name,
    t4.storehouse_name,
    t5.location_name,
    t6.name as unit_base_name,
    t7.barcode,
    t8.name as special_stock_name,
    t9.short_name as vendor_name,
    t10.short_name as customer_name,
    t11.name as material_type_name
    from s_inv_reserve_inventory t
        LEFT JOIN s_bas_material t1 ON t1.material_sid = t.material_sid
        LEFT JOIN s_bas_sku t2 ON t2.sku_sid = t.sku1_sid
        LEFT JOIN s_bas_sku t3 ON t3.sku_sid = t.sku2_sid
        LEFT JOIN s_bas_storehouse t4 on t4.storehouse_sid=t.storehouse_sid
        LEFT JOIN s_bas_storehouse_location t5 on t5.storehouse_location_sid=t.storehouse_location_sid
        left join s_con_measure_unit t6 on t6.code=t1.unit_base
        left join s_bas_material_barcode t7 on t7.barcode_sid=t.barcode_sid
        left join s_con_special_stock t8 on t8.code =t.special_stock
        LEFT JOIN s_bas_vendor t9 ON t9.vendor_sid = t.vendor_sid
        LEFT JOIN s_bas_customer t10 on t10.customer_sid=t.customer_sid
        LEFT JOIN s_con_material_type t11 ON t11.code = t1.material_type
    </sql>

    <select id="selectInvReserveInventoryById" parameterType="Long" resultMap="InvReserveInventoryResult">
        <include refid="selectInvReserveInventoryVo"/>
        where t.reserve_stock_sid = #{reserveStockSid}
    </select>


    <select id="report" parameterType="com.platform.ems.domain.dto.request.InvReserveInventoryRequest"
            resultType="com.platform.ems.domain.dto.response.InvReserveInventoryResponse">
        <include refid="getInfo"/>
        <where>
            <if test="storehouseSid != null and storehouseSid != '' ">
                and t.storehouse_sid =#{storehouseSid}
            </if>
            <if test="businessOrderCode != null and businessOrderCode != '' ">
                and t.business_order_code like
                concat('%',
                #{businessOrderCode}, '%')
            </if>
            <if test="storehouseLocationSidList != null and storehouseLocationSidList.length >0">
                and t.storehouse_location_sid in
                (<foreach collection="storehouseLocationSidList" item="item" separator=",">
                #{item}</foreach>)
            </if>
            <if test="vendorSidList != null and vendorSidList.length >0">
                and t.vendor_sid in
                (<foreach collection="vendorSidList" item="item" separator=",">
                #{item}</foreach>)
            </if>
            <if test="materialTypeList != null and materialTypeList.length >0">
                and t1.material_type in
                (<foreach collection="materialTypeList" item="item" separator=",">
                #{item}</foreach>)
            </if>
            <if test="specialStockList != null and specialStockList.length >0">
                and t.special_stock in
                (<foreach collection="specialStockList" item="item" separator=",">
                #{item}</foreach>)
            </if>
            <if test="customerSidList != null and customerSidList.length >0">
                and t.customer_sid in
                (<foreach collection="customerSidList" item="item" separator=",">
                #{item}</foreach>)
            </if>
            <if test="materialCode != null and materialCode !=''">
                and (<foreach collection="materialCode.split(';')" item="item" separator="or">t1.material_code like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
            <if test="materialName != null and materialName !=''">
                and (<foreach collection="materialName.split(';')" item="item" separator="or">t1.material_name like
                concat('%',
                #{item}, '%')
            </foreach>)
            </if>
        </where>
    </select>


    <!--添加多个-->
    <insert id="inserts">
        insert into s_inv_reserve_inventory
        <trim prefix="(" suffix=")" suffixOverrides=",">
                                                client_id,
                                                                reserve_stock_sid,
                                                                material_sid,
                                                                sku1_sid,
                                                                sku2_sid,
                                                                barcode_sid,
                                                                storehouse_sid,
                                                                storehouse_location_sid,
                                                                reserve_type,
                                                                quantity,
                                                                unit_base,
                                                                business_order_sid,
                                                                business_order_code,
                                                                business_order_item_sid,
                                                                business_order_item_num,
                                                                material_requisition_sid,
                                                                material_requisition_code,
                                                                material_requisition_item_sid,
                                                                material_requisition_item_num,
                                                                delivery_note_sid,
                                                                delivery_note_code,
                                                                delivery_note_item_sid,
                                                                delivery_note_item_num,
                                                                sales_order_sid,
                                                                sales_order_code,
                                                                sales_order_item_sid,
                                                                sales_order_item_num,
                                                                purchase_order_sid,
                                                                purchase_order_code,
                                                                purchase_order_item_sid,
                                                                purchase_order_item_num,
                                                                inventory_transfer_sid,
                                                                inventory_transfer_code,
                                                                inventory_transfer_item_sid,
                                                                inventory_transfer_item_num,
                                                                good_issue_note_sid,
                                                                good_issue_note_code,
                                                                good_issue_note_item_sid,
                                                                good_issue_note_item_num,
                                                                manufacture_order_sid,
                                                                manufacture_order_code,
                                                                remark,
                                                                creator_account,
                                                                create_date,
                                                                updater_account,
                                                                update_date,
                                                                confirmer_account,
                                                                confirm_date,
                                                                data_source_sys,
                                                                vendor_sid,
                                                                customer_sid,
                                                                special_stock,

                                    </trim>
        values
        <foreach collection="list" item="item" separator=",">
            <trim prefix=" (" suffix=")" suffixOverrides=",">
                                                            #{item.clientId},
                                                                                #{item.reserveStockSid},
                                                                                #{item.materialSid},
                                                                                #{item.sku1Sid},
                                                                                #{item.sku2Sid},
                                                                                #{item.barcodeSid},
                                                                                #{item.storehouseSid},
                                                                                #{item.storehouseLocationSid},
                                                                                #{item.reserveType},
                                                                                #{item.quantity},
                                                                                #{item.unitBase},
                                                                                #{item.businessOrderSid},
                                                                                #{item.businessOrderCode},
                                                                                #{item.businessOrderItemSid},
                                                                                #{item.businessOrderItemNum},
                                                                                #{item.materialRequisitionSid},
                                                                                #{item.materialRequisitionCode},
                                                                                #{item.materialRequisitionItemSid},
                                                                                #{item.materialRequisitionItemNum},
                                                                                #{item.deliveryNoteSid},
                                                                                #{item.deliveryNoteCode},
                                                                                #{item.deliveryNoteItemSid},
                                                                                #{item.deliveryNoteItemNum},
                                                                                #{item.salesOrderSid},
                                                                                #{item.salesOrderCode},
                                                                                #{item.salesOrderItemSid},
                                                                                #{item.salesOrderItemNum},
                                                                                #{item.purchaseOrderSid},
                                                                                #{item.purchaseOrderCode},
                                                                                #{item.purchaseOrderItemSid},
                                                                                #{item.purchaseOrderItemNum},
                                                                                #{item.inventoryTransferSid},
                                                                                #{item.inventoryTransferCode},
                                                                                #{item.inventoryTransferItemSid},
                                                                                #{item.inventoryTransferItemNum},
                                                                                #{item.goodIssueNoteSid},
                                                                                #{item.goodIssueNoteCode},
                                                                                #{item.goodIssueNoteItemSid},
                                                                                #{item.goodIssueNoteItemNum},
                                                                                #{item.manufactureOrderSid},
                                                                                #{item.manufactureOrderCode},
                                                                                #{item.remark},
                                                                                #{item.creatorAccount},
                                                                                #{item.createDate},
                                                                                #{item.updaterAccount},
                                                                                #{item.updateDate},
                                                                                #{item.confirmerAccount},
                                                                                #{item.confirmDate},
                                                                                #{item.dataSourceSys},
                                                                                #{item.vendorSid},
                                                                                #{item.customerSid},
                                                                                #{item.specialStock},
                                                </trim>
        </foreach>
    </insert>

    <!--更新-->
    <update id="updateAllById">
        update s_inv_reserve_inventory
        <trim prefix="SET" suffixOverrides=",">
                                                client_id = #{clientId},
                                                                reserve_stock_sid = #{reserveStockSid},
                                                                material_sid = #{materialSid},
                                                                sku1_sid = #{sku1Sid},
                                                                sku2_sid = #{sku2Sid},
                                                                barcode_sid = #{barcodeSid},
                                                                storehouse_sid = #{storehouseSid},
                                                                storehouse_location_sid = #{storehouseLocationSid},
                                                                reserve_type = #{reserveType},
                                                                quantity = #{quantity},
                                                                unit_base = #{unitBase},
                                                                business_order_sid = #{businessOrderSid},
                                                                business_order_code = #{businessOrderCode},
                                                                business_order_item_sid = #{businessOrderItemSid},
                                                                business_order_item_num = #{businessOrderItemNum},
                                                                material_requisition_sid = #{materialRequisitionSid},
                                                                material_requisition_code = #{materialRequisitionCode},
                                                                material_requisition_item_sid = #{materialRequisitionItemSid},
                                                                material_requisition_item_num = #{materialRequisitionItemNum},
                                                                delivery_note_sid = #{deliveryNoteSid},
                                                                delivery_note_code = #{deliveryNoteCode},
                                                                delivery_note_item_sid = #{deliveryNoteItemSid},
                                                                delivery_note_item_num = #{deliveryNoteItemNum},
                                                                sales_order_sid = #{salesOrderSid},
                                                                sales_order_code = #{salesOrderCode},
                                                                sales_order_item_sid = #{salesOrderItemSid},
                                                                sales_order_item_num = #{salesOrderItemNum},
                                                                purchase_order_sid = #{purchaseOrderSid},
                                                                purchase_order_code = #{purchaseOrderCode},
                                                                purchase_order_item_sid = #{purchaseOrderItemSid},
                                                                purchase_order_item_num = #{purchaseOrderItemNum},
                                                                inventory_transfer_sid = #{inventoryTransferSid},
                                                                inventory_transfer_code = #{inventoryTransferCode},
                                                                inventory_transfer_item_sid = #{inventoryTransferItemSid},
                                                                inventory_transfer_item_num = #{inventoryTransferItemNum},
                                                                good_issue_note_sid = #{goodIssueNoteSid},
                                                                good_issue_note_code = #{goodIssueNoteCode},
                                                                good_issue_note_item_sid = #{goodIssueNoteItemSid},
                                                                good_issue_note_item_num = #{goodIssueNoteItemNum},
                                                                manufacture_order_sid = #{manufactureOrderSid},
                                                                manufacture_order_code = #{manufactureOrderCode},
                                                                remark = #{remark},
                                                                creator_account = #{creatorAccount},
                                                                create_date = #{createDate},
                                                                updater_account = #{updaterAccount},
                                                                update_date = #{updateDate},
                                                                confirmer_account = #{confirmerAccount},
                                                                confirm_date = #{confirmDate},
                                                                data_source_sys = #{dataSourceSys},
                                    </trim>
        where reserve_stock_sid = #{reserveStockSid}
    </update>

    <!--更新多个-->
    <update id="updatesAllById">
        <foreach collection="list" item="o" separator=";">
            update s_inv_reserve_inventory
            <trim prefix="SET" suffixOverrides=",">
                                                            client_id = #{clientId},
                                                                                reserve_stock_sid = #{reserveStockSid},
                                                                                material_sid = #{materialSid},
                                                                                sku1_sid = #{sku1Sid},
                                                                                sku2_sid = #{sku2Sid},
                                                                                barcode_sid = #{barcodeSid},
                                                                                storehouse_sid = #{storehouseSid},
                                                                                storehouse_location_sid = #{storehouseLocationSid},
                                                                                reserve_type = #{reserveType},
                                                                                quantity = #{quantity},
                                                                                unit_base = #{unitBase},
                                                                                business_order_sid = #{businessOrderSid},
                                                                                business_order_code = #{businessOrderCode},
                                                                                business_order_item_sid = #{businessOrderItemSid},
                                                                                business_order_item_num = #{businessOrderItemNum},
                                                                                material_requisition_sid = #{materialRequisitionSid},
                                                                                material_requisition_code = #{materialRequisitionCode},
                                                                                material_requisition_item_sid = #{materialRequisitionItemSid},
                                                                                material_requisition_item_num = #{materialRequisitionItemNum},
                                                                                delivery_note_sid = #{deliveryNoteSid},
                                                                                delivery_note_code = #{deliveryNoteCode},
                                                                                delivery_note_item_sid = #{deliveryNoteItemSid},
                                                                                delivery_note_item_num = #{deliveryNoteItemNum},
                                                                                sales_order_sid = #{salesOrderSid},
                                                                                sales_order_code = #{salesOrderCode},
                                                                                sales_order_item_sid = #{salesOrderItemSid},
                                                                                sales_order_item_num = #{salesOrderItemNum},
                                                                                purchase_order_sid = #{purchaseOrderSid},
                                                                                purchase_order_code = #{purchaseOrderCode},
                                                                                purchase_order_item_sid = #{purchaseOrderItemSid},
                                                                                purchase_order_item_num = #{purchaseOrderItemNum},
                                                                                inventory_transfer_sid = #{inventoryTransferSid},
                                                                                inventory_transfer_code = #{inventoryTransferCode},
                                                                                inventory_transfer_item_sid = #{inventoryTransferItemSid},
                                                                                inventory_transfer_item_num = #{inventoryTransferItemNum},
                                                                                good_issue_note_sid = #{goodIssueNoteSid},
                                                                                good_issue_note_code = #{goodIssueNoteCode},
                                                                                good_issue_note_item_sid = #{goodIssueNoteItemSid},
                                                                                good_issue_note_item_num = #{goodIssueNoteItemNum},
                                                                                manufacture_order_sid = #{manufactureOrderSid},
                                                                                manufacture_order_code = #{manufactureOrderCode},
                                                                                remark = #{remark},
                                                                                creator_account = #{creatorAccount},
                                                                                create_date = #{createDate},
                                                                                updater_account = #{updaterAccount},
                                                                                update_date = #{updateDate},
                                                                                confirmer_account = #{confirmerAccount},
                                                                                confirm_date = #{confirmDate},
                                                                                data_source_sys = #{dataSourceSys},
                                                </trim>
            where reserve_stock_sid = #{reserveStockSid}
        </foreach>
    </update>

</mapper>
